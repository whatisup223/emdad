{% extends "base.html" %}

{% block title %}{{ article.get_title() }} - News - {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{{ article.get_excerpt() | truncate(160) }}{% endblock %}

{% block og_title %}{{ article.get_title() }}{% endblock %}
{% block og_description %}{{ article.get_excerpt() | truncate(160) }}{% endblock %}
{% block og_image %}
{% if article.cover_image %}
{{ url_for('static', filename='uploads/news/' + article.cover_image, _external=True) }}
{% else %}
{{ super() }}
{% endif %}
{% endblock %}

{% block content %}
<!-- Article Header -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('main.news') }}">News</a></li>
                        <li class="breadcrumb-item active">{{ article.get_title() | truncate(50) }}</li>
                    </ol>
                </nav>
                
                <div class="article-meta mb-3">
                    <span class="text-primary">{{ article.publish_at.strftime('%B %d, %Y') }}</span>
                    {% if article.featured %}
                    <span class="badge bg-warning text-dark ms-2">Featured</span>
                    {% endif %}
                </div>
                
                <h1 class="display-6 fw-bold mb-4">{{ article.get_title() }}</h1>
                
                {% if article.get_excerpt() %}
                <p class="lead text-muted mb-4">{{ article.get_excerpt() }}</p>
                {% endif %}
                
                <!-- Social Share Buttons -->
                <div class="d-flex gap-2 mb-4">
                    <button class="btn btn-outline-primary btn-sm" onclick="shareArticle('facebook')">
                        <i class="fab fa-facebook-f me-1"></i>Share
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="shareArticle('twitter')">
                        <i class="fab fa-twitter me-1"></i>Tweet
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="shareArticle('whatsapp')">
                        <i class="fab fa-whatsapp me-1"></i>WhatsApp
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="shareArticle('copy')">
                        <i class="fas fa-link me-1"></i>Copy Link
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Article Content -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Cover Image -->
                {% if article.cover_image %}
                <div class="mb-5">
                    <img src="{{ url_for('static', filename='uploads/news/' + article.cover_image) }}" 
                         alt="{{ article.get_title() }}" 
                         class="img-fluid rounded shadow">
                </div>
                {% endif %}
                
                <!-- Article Body -->
                <div class="article-content">
                    {% if article.get_content() %}
                        {{ article.get_content() | safe }}
                    {% else %}
                        <p>{{ article.get_excerpt() }}</p>
                        <p>This is a sample news article for Emdad Global. In a real implementation, this would contain the full article content from the database.</p>
                        
                        <h3>Key Highlights</h3>
                        <ul>
                            <li>Expansion into new international markets</li>
                            <li>Enhanced quality control processes</li>
                            <li>Sustainable agricultural practices</li>
                            <li>Strengthened partnerships with global distributors</li>
                        </ul>
                        
                        <p>Emdad Global continues to lead the Egyptian agricultural export industry with innovative solutions and unwavering commitment to quality. Our team works tirelessly to ensure that Egyptian agricultural products reach global markets with the highest standards of freshness and quality.</p>
                        
                        <blockquote class="blockquote border-start border-primary border-4 ps-4 my-4">
                            <p class="mb-0">"Quality is not just our goalâ€”it's our foundation. Every product that bears the Emdad Global name represents our commitment to excellence."</p>
                            <footer class="blockquote-footer mt-2">Emdad Global Management Team</footer>
                        </blockquote>
                        
                        <p>For more information about our products and services, please don't hesitate to contact our team. We're always ready to discuss how we can meet your agricultural sourcing needs.</p>
                    {% endif %}
                </div>
                
                <!-- Tags -->
                {% if article.get_tags_list() %}
                <div class="mt-5 pt-4 border-top">
                    <h6 class="mb-3">Tags:</h6>
                    <div class="d-flex flex-wrap gap-2">
                        {% for tag in article.get_tags_list() %}
                        <span class="badge bg-light text-dark">#{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Share Again -->
                <div class="mt-5 pt-4 border-top">
                    <h6 class="mb-3">Share this article:</h6>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary btn-sm" onclick="shareArticle('facebook')">
                            <i class="fab fa-facebook-f me-1"></i>Facebook
                        </button>
                        <button class="btn btn-info btn-sm" onclick="shareArticle('twitter')">
                            <i class="fab fa-twitter me-1"></i>Twitter
                        </button>
                        <button class="btn btn-success btn-sm" onclick="shareArticle('whatsapp')">
                            <i class="fab fa-whatsapp me-1"></i>WhatsApp
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="shareArticle('copy')">
                            <i class="fas fa-link me-1"></i>Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Related Articles -->
{% if related_articles %}
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="mb-3">Related Articles</h2>
            <p class="lead text-muted">More news and updates from Emdad Global</p>
        </div>
        
        <div class="row">
            {% for related in related_articles %}
            <div class="col-lg-4 mb-4">
                <div class="card h-100 border-0 shadow-sm news-card">
                    {% if related.cover_image %}
                    <img src="{{ url_for('static', filename='uploads/news/' + related.cover_image) }}" 
                         class="card-img-top" alt="{{ related.get_title() }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                    <div class="card-img-top bg-primary d-flex align-items-center justify-content-center" style="height: 200px;">
                        <i class="fas fa-newspaper fa-3x text-white"></i>
                    </div>
                    {% endif %}
                    
                    <div class="card-body d-flex flex-column">
                        <div class="mb-2">
                            <small class="text-muted">{{ related.publish_at.strftime('%B %d, %Y') }}</small>
                            {% if related.featured %}
                            <span class="badge bg-warning text-dark ms-2">Featured</span>
                            {% endif %}
                        </div>
                        
                        <h6 class="card-title">{{ related.get_title() }}</h6>
                        <p class="card-text text-muted flex-grow-1">{{ related.get_excerpt() | truncate(100) }}</p>
                        
                        <div class="mt-auto">
                            <a href="{{ url_for('main.news_detail', slug=related.slug) }}" class="btn btn-outline-primary btn-sm">
                                Read More <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ url_for('main.news') }}" class="btn btn-primary">
                <i class="fas fa-newspaper me-2"></i>View All News
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Call to Action -->
<section class="py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="mb-2">Stay Connected</h3>
                <p class="mb-0">Subscribe to our newsletter for the latest updates and industry insights.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{{ url_for('main.contact') }}" class="btn btn-light btn-lg">
                    <i class="fas fa-envelope me-2"></i>Contact Us
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Social sharing functionality
function shareArticle(platform) {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    const text = encodeURIComponent('{{ article.get_excerpt() | truncate(100) }}');
    
    let shareUrl = '';
    
    switch(platform) {
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
            break;
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
            break;
        case 'whatsapp':
            shareUrl = `https://wa.me/?text=${title}%20${url}`;
            break;
        case 'copy':
            navigator.clipboard.writeText(window.location.href).then(() => {
                // Show success message
                const button = event.target.closest('button');
                const originalContent = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                button.classList.add('btn-success');
                button.classList.remove('btn-outline-secondary', 'btn-secondary');
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-secondary');
                }, 2000);
            });
            return;
    }
    
    if (shareUrl) {
        window.open(shareUrl, '_blank', 'width=600,height=400');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to related news cards
    const newsCards = document.querySelectorAll('.news-card');
    newsCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Smooth scrolling for internal links
    const articleContent = document.querySelector('.article-content');
    if (articleContent) {
        const links = articleContent.querySelectorAll('a[href^="#"]');
        links.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    }
    
    // Reading progress indicator
    const article = document.querySelector('.article-content');
    if (article) {
        const progressBar = document.createElement('div');
        progressBar.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(to right, #007bff, #28a745);
            z-index: 9999;
            transition: width 0.3s ease;
        `;
        document.body.appendChild(progressBar);
        
        window.addEventListener('scroll', function() {
            const articleTop = article.offsetTop;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;
            
            const progress = Math.min(
                Math.max((scrollTop - articleTop + windowHeight) / articleHeight, 0),
                1
            );
            
            progressBar.style.width = (progress * 100) + '%';
        });
    }
});
</script>
{% endblock %}
