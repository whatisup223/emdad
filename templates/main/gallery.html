{% extends "base.html" %}

{% block title %}{% if is_rtl %}المعرض{% else %}Gallery{% endif %} - {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{% if is_rtl %}استعرض معرضنا الذي يبرز المزارع وبيوت التعبئة ومخازن التبريد وعمليات التصدير في إمداد جلوبال.{% else %}Explore our gallery showcasing Egyptian agricultural facilities, farms, packing houses, cold storage, and export operations at Emdad Global.{% endif %}{% endblock %}

{% block content %}
<!-- Page Header (like Certifications hero) -->
<section class="py-5 products-hero position-relative overflow-hidden" style="background:#689b8a;">
    <style>
      .products-hero { min-height: 420px; }
      .products-hero .section-heading, .products-hero .lead { color:#fff !important; }
      .products-hero .breadcrumb, .products-hero .breadcrumb * { color:rgba(255,255,255,0.85) !important; }
      .products-hero .section-badge { background: var(--secondary-gradient) !important; color: var(--dark-color) !important; }
      .products-hero .pattern-dots { color: rgba(255,255,255,.15); }
      .products-hero .section-heading { color:#fff !important; }
    </style>

    <!-- Background Elements -->
    <div class="position-absolute top-0 start-0 w-100 h-100">
        <div class="pattern-dots opacity-25"></div>
    </div>

    <!-- START_PRODUCTS_ANIMATIONS (identical to Certifications) -->
    <style>
      .hero-animated-bg { position:absolute; inset:0; z-index:0; pointer-events:none; }
      .hero-bubble { position:absolute; border-radius:50%; background: rgba(255,255,255,.18); filter: blur(.4px); animation: heroFloat 10s ease-in-out infinite; }
      .hero-bubble.b1 { width:90px; height:90px; top:12%; left:10%; animation-duration: 12s; }
      .hero-bubble.b2 { width:140px; height:140px; bottom:10%; right:12%; animation-duration: 14s; animation-direction: reverse; }
      .hero-bubble.b3 { width:70px; height:70px; top:35%; right:28%; animation-duration: 11s; }
      .hero-bubble.b4 { width:110px; height:110px; bottom:20%; left:22%; animation-duration: 13s; }
      @keyframes heroFloat { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-14px);} }

      .grid-animated-bg { position:absolute; inset:0; z-index:0; pointer-events:none; }
      .leaf { position:absolute; color: rgba(249,203,153,.55); font-size: 1rem; animation: leafDrift 18s linear infinite; }
      .leaf.l1 { top:10%; left:-40px; animation-duration: 18s; }
      .leaf.l2 { top:40%; left:-60px; animation-duration: 20s; animation-delay: 3s; }
      .leaf.l3 { top:70%; left:-50px; animation-duration: 22s; animation-delay: 6s; }
      @keyframes leafDrift { 0%{ transform: translateX(0) rotate(0deg);} 50%{ transform: translateX(50vw) rotate(10deg);} 100%{ transform: translateX(100vw) rotate(0deg);} }

      @media (prefers-reduced-motion: reduce) {
        .hero-bubble, .leaf { animation: none !important; }
      }
    </style>

    <!-- Animated layer in hero -->
    <div class="hero-animated-bg" aria-hidden="true">
      <span class="hero-bubble b1"></span>
      <span class="hero-bubble b2"></span>
      <span class="hero-bubble b3"></span>
      <span class="hero-bubble b4"></span>
    </div>
    <!-- Leaves layer -->
    <div class="grid-animated-bg" aria-hidden="true" id="galleryHeroLeaves"></div>
    <!-- END_PRODUCTS_ANIMATIONS -->

    <style>
      @keyframes leafDriftReverse { 0%{ transform: translateX(0) rotate(0deg);} 50%{ transform: translateX(-50vw) rotate(-10deg);} 100%{ transform: translateX(-100vw) rotate(0deg);} }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const container = document.getElementById('galleryHeroLeaves');
        if(!container) return;
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (prefersReduced) return;
        const COUNT = 12; // reduced slightly
        for (let i = 0; i < COUNT; i++) {
          const leaf = document.createElement('i');
          leaf.className = 'fas fa-leaf leaf';
          const top = (Math.random() * 92) + 2; // 2..94%
          leaf.style.top = top.toFixed(2) + '%';
          const fromLeft = Math.random() < 0.5;
          const offset = -30 - Math.random() * 70; // -30..-100px
          if (fromLeft) { leaf.style.left = offset.toFixed(0) + 'px'; leaf.style.animationName = 'leafDrift'; }
          else { leaf.style.right = offset.toFixed(0) + 'px'; leaf.style.animationName = 'leafDriftReverse'; }
          const duration = 16 + Math.random() * 12; // 16..28s
          leaf.style.animationDuration = duration.toFixed(2) + 's';
          const delay = Math.random() * 10; // 0..10s
          leaf.style.animationDelay = delay.toFixed(2) + 's';
          const size = 0.8 + Math.random() * 0.9; // 0.8..1.7rem
          leaf.style.fontSize = size.toFixed(2) + 'rem';
          container.appendChild(leaf);
        }
      });
    </script>

    <style>
      /* Mobile fixes for animated layers */
      @media (max-width: 767.98px) {
        .hero-animated-bg { display: none !important; }
        .grid-animated-bg { display: none !important; }
        .products-hero { padding-top: 2.25rem !important; padding-bottom: 2.25rem !important; min-height: 300px; }
      }
    </style>

    <div class="container position-relative">
        <div class="row align-items-center g-4">
            <div class="col-lg-8" data-aos="fade-right">
                <div class="mb-3">
                    <div class="section-badge badge bg-gradient-primary text-white px-4 py-2 rounded-pill mb-3 fs-6 fw-semibold">
                        <i class="fas fa-images me-2"></i>{% if is_rtl %}معرض الصور{% else %}Gallery{% endif %}
                    </div>
                    <h1 class="section-heading {{ 'arabic-heading' if is_rtl else 'english-heading' }} mb-3">
                        {% if is_rtl %}تعرّف على منشآتنا{% else %}Our Gallery{% endif %}
                    </h1>
                    <p class="lead {{ 'arabic-text' if is_rtl else 'english-text' }} text-white-75">
                        {% if is_rtl %}اكتشف منشآتنا وعملياتنا العالمية بالجودة والاحترافية.{% else %}Discover our world-class facilities and operations.{% endif %}
                    </p>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end" data-aos="fade-left">
                <a href="{{ url_for('main.contact') }}" class="btn btn-primary btn-lg px-4 py-3 hover-lift" style="border-radius: 12px;">
                    <i class="fas fa-envelope me-2"></i>{% if is_rtl %}تواصل معنا{% else %}Contact Us{% endif %}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Gallery Filters -->
<section class="py-4 bg-gradient-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex flex-wrap gap-2 gallery-filters">
                    {# All button #}
                    <button class="btn rounded-pill px-3 gallery-filter {{ 'btn-primary active' if selected_category == 'all' else 'btn-outline-primary' }}" data-filter="all">
                        <i class="fas fa-th me-1"></i>{% if is_rtl %}كل الصور{% else %}All Images{% endif %}
                    </button>

                    {# Build all filter buttons dynamically from categories coming from DB #}
                    {% set labels = (category_names if category_names is defined else None) or {'farms':('Farms','المزارع'), 'packing':('Packing Houses','بيوت التعبئة'), 'storage':('Cold Storage','التخزين البارد'), 'exports':('Exports','التصدير')} %}
                    {% for key in categories if key %}
                    {% set icon = (category_icons.get(key) if category_icons is defined else None) or (
                        'fa-seedling' if key=='farms' else ('fa-industry' if key=='packing' else ('fa-warehouse' if key=='storage' else ('fa-ship' if key=='exports' else 'fa-tags')))
                    ) %}
                    {% set default_label = key|replace('-', ' ')|replace('_',' ')|title %}
                    {% set label_pair = labels.get(key, (default_label, default_label)) %}
                    <button class="btn rounded-pill px-3 gallery-filter {{ 'btn-primary active' if selected_category == key else 'btn-outline-primary' }}" data-filter="{{ key }}">
                        <i class="fas {{ icon }} me-1"></i>{% if is_rtl %}{{ label_pair[1] }}{% else %}{{ label_pair[0] }}{% endif %}
                    </button>
                    {% endfor %}
                </div>
            </div>
            
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <span class="text-muted">
                    <span id="visible-count">{{ gallery_items|length }}</span> {% if is_rtl %}صور{% else %}images{% endif %}
                    {% if selected_category != 'all' %}
                    {% set _labels = (category_names if category_names is defined else None) or {'farms':('Farms','المزارع'), 'packing':('Packing Houses','بيوت التعبئة'), 'storage':('Cold Storage','التخزين البارد'), 'exports':('Exports','التصدير')} %}
                    {% if is_rtl %}في {{ _labels.get(selected_category, (selected_category|title, selected_category|title))[1] }}{% else %}in {{ _labels.get(selected_category, (selected_category|title, selected_category|title))[0] }}{% endif %}
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Gallery Grid -->
<section class="py-5">
    <div class="container">
        {% if gallery_items %}
        <div class="row gallery-grid" id="gallery-grid">
            {% for item in gallery_items %}
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="{{ item.category }}" data-aos="fade-up" data-aos-delay="{{ loop.index * 100 }}">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('main.uploaded_file', filename='gallery/' + item.image_path) if item.image_path else url_for('static', filename='images/placeholder-gallery.jpg') }}"
                         alt="{{ item.get_title('ar' if is_rtl else 'en') }}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('main.uploaded_file', filename='gallery/' + item.image_path) if item.image_path else url_for('static', filename='images/placeholder-gallery.jpg') }}', '{{ item.get_title('ar' if is_rtl else 'en') }}', '{{ item.get_description('ar' if is_rtl else 'en') }}')">

                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{{ item.get_title('ar' if is_rtl else 'en') }}</h6>
                            {% set _desc = item.get_description('ar' if is_rtl else 'en') %}
                            {% if _desc %}
                            <p class="mb-0 small opacity-75">{{ _desc | truncate(80) }}</p>
                            {% endif %}
                            <div class="mt-2">
                                {% set default_item_label = item.category|replace('-', ' ')|replace('_',' ')|title %}
                                {% set item_label_pair = labels.get(item.category, (default_item_label, default_item_label)) %}
                                <span class="badge bg-primary">{% if is_rtl %}{{ item_label_pair[1] }}{% else %}{{ item_label_pair[0] }}{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% else %}
        <!-- Default gallery items if none in database -->
        <div class="row gallery-grid" id="gallery-grid">
            <!-- Farms -->
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="farms" data-aos="fade-up" data-aos-delay="100">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/farm-1.jpg') }}" 
                         alt="{% if is_rtl %}بستان برتقال{% else %}Orange Grove{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/farm-1.jpg') }}', '{% if is_rtl %}بستان برتقال{% else %}Orange Grove{% endif %}', '{% if is_rtl %}زراعة برتقال متميزة في دلتا النيل{% else %}Premium orange cultivation in the Nile Delta region{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}بستان برتقال{% else %}Orange Grove{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}زراعة برتقال متميزة في دلتا النيل{% else %}Premium orange cultivation in the Nile Delta region{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-success">{% if is_rtl %}المزارع{% else %}Farms{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Packing Houses -->
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="packing" data-aos="fade-up" data-aos-delay="200">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/packing-1.jpg') }}" 
                         alt="{% if is_rtl %}خط تعبئة حديث{% else %}Modern Packing Line{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/packing-1.jpg') }}', '{% if is_rtl %}خط تعبئة حديث{% else %}Modern Packing Line{% endif %}', '{% if is_rtl %}منشأة تعبئة آلية متطورة{% else %}State-of-the-art automated packing facility{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}خط تعبئة حديث{% else %}Modern Packing Line{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}منشأة تعبئة آلية متطورة{% else %}State-of-the-art automated packing facility{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-info">{% if is_rtl %}التعبئة{% else %}Packing{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Cold Storage -->
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="storage" data-aos="fade-up" data-aos-delay="300">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/storage-1.jpg') }}" 
                         alt="{% if is_rtl %}منشأة تخزين بارد{% else %}Cold Storage Facility{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/storage-1.jpg') }}', '{% if is_rtl %}منشأة تخزين بارد{% else %}Cold Storage Facility{% endif %}', '{% if is_rtl %}تخزين بدرجات حرارة مضبوطة للحفاظ على الطزاجة المثلى{% else %}Temperature-controlled storage maintaining optimal freshness{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}منشأة تخزين بارد{% else %}Cold Storage Facility{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}تخزين بدرجات حرارة مضبوطة للحفاظ على الطزاجة المثلى{% else %}Temperature-controlled storage maintaining optimal freshness{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-primary">{% if is_rtl %}التخزين{% else %}Storage{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Exports -->
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="exports" data-aos="fade-up" data-aos-delay="400">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/export-1.jpg') }}" 
                         alt="{% if is_rtl %}تحميل الحاويات{% else %}Container Loading{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/export-1.jpg') }}', '{% if is_rtl %}تحميل الحاويات{% else %}Container Loading{% endif %}', '{% if is_rtl %}حاويات مبردة جاهزة للشحن الدولي{% else %}Refrigerated containers ready for international shipping{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}تحميل الحاويات{% else %}Container Loading{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}حاويات مبردة جاهزة للشحن الدولي{% else %}Refrigerated containers ready for international shipping{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-warning">{% if is_rtl %}التصدير{% else %}Exports{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- More sample items -->
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="farms" data-aos="fade-up" data-aos-delay="500">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/farm-2.jpg') }}" 
                         alt="{% if is_rtl %}كروم العنب{% else %}Grape Vineyard{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/farm-2.jpg') }}', '{% if is_rtl %}كروم العنب{% else %}Grape Vineyard{% endif %}', '{% if is_rtl %}زراعة عنب مائدة متميزة{% else %}Premium table grape cultivation{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}كروم العنب{% else %}Grape Vineyard{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}زراعة عنب مائدة متميزة{% else %}Premium table grape cultivation{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-success">{% if is_rtl %}المزارع{% else %}Farms{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4 gallery-item fade-in" data-category="packing" data-aos="fade-up" data-aos-delay="600">
                <div class="feature-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <img src="{{ url_for('static', filename='images/gallery/packing-2.jpg') }}" 
                         alt="{% if is_rtl %}مراقبة الجودة{% else %}Quality Control{% endif %}"
                         class="img-fluid gallery-image"
                         style="width: 100%; height: 250px; object-fit: cover; cursor: pointer;"
                         onclick="openLightbox('{{ url_for('static', filename='images/gallery/packing-2.jpg') }}', '{% if is_rtl %}مراقبة الجودة{% else %}Quality Control{% endif %}', '{% if is_rtl %}عملية تفتيش جودة صارمة{% else %}Rigorous quality inspection process{% endif %}')">
                    
                    <div class="gallery-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-end p-3">
                        <div class="text-white">
                            <h6 class="mb-1">{% if is_rtl %}مراقبة الجودة{% else %}Quality Control{% endif %}</h6>
                            <p class="mb-0 small opacity-75">{% if is_rtl %}عملية تفتيش جودة صارمة{% else %}Rigorous quality inspection process{% endif %}</p>
                            <div class="mt-2">
                                <span class="badge bg-info">{% if is_rtl %}التعبئة{% else %}Packing{% endif %}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- No Results Message -->
        <div id="no-results" class="text-center py-5" style="display: none;">
            <i class="fas fa-search fa-4x text-muted mb-4"></i>
            <h3 class="mb-3">{% if is_rtl %}لا توجد صور{% else %}No Images Found{% endif %}</h3>
            <p class="text-muted mb-4">{% if is_rtl %}لا توجد صور مطابقة للتصنيف المختار.{% else %}No images match the selected category.{% endif %}</p>
            <button class="btn btn-primary gallery-filter" data-filter="all">
                <i class="fas fa-th me-1"></i>{% if is_rtl %}عرض كل الصور{% else %}Show All Images{% endif %}
            </button>
        </div>
    </div>
</section>

<!-- Lightbox Modal -->
<div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white" id="lightboxTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center p-0">
                <img id="lightboxImage" src="" alt="" class="img-fluid" style="max-height: 80vh;">
            </div>
            <div class="modal-footer border-0">
                <p class="text-white-50 mb-0" id="lightboxDescription"></p>
            </div>
        </div>
    </div>
</div>

<!-- CTA: Ready to Partner (copied from About) -->
<section class="py-5 bg-gradient-light">
    <div class="container">
        <div class="row align-items-center text-center">
            <div class="col-lg-8 mx-auto" data-aos="fade-up">
                <h2 class="display-6 english-heading mb-3">{% if is_rtl %}جاهز للتعاون معنا؟{% else %}Ready to Partner with Us?{% endif %}</h2>
                <p class="lead text-muted mb-4">{% if is_rtl %}تواصل معنا الآن واكتشف حلول التوريد الموثوقة لأسواقك العالمية.{% else %}Get in touch and discover reliable sourcing solutions for your markets.{% endif %}</p>
                <div class="d-flex flex-wrap justify-content-center gap-3">
                    <a href="{{ url_for('main.contact') }}" class="btn btn-primary btn-lg px-5 py-3 hover-lift"><i class="fas fa-envelope me-2"></i>{% if is_rtl %}تواصل الآن{% else %}Contact Us{% endif %}</a>
                    <a href="{{ url_for('main.products') }}" class="btn btn-outline-primary btn-lg px-5 py-3 hover-lift"><i class="fas fa-leaf me-2"></i>{% if is_rtl %}تصفح المنتجات{% else %}View Products{% endif %}</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const galleryFilters = document.querySelectorAll('.gallery-filter');
    const galleryItems = document.querySelectorAll('.gallery-item');
    const visibleCount = document.getElementById('visible-count');
    const noResults = document.getElementById('no-results');
    
    // Gallery filtering
    galleryFilters.forEach(filter => {
        filter.addEventListener('click', function() {
            const filterValue = this.dataset.filter;
            
            // Update active filter
            galleryFilters.forEach(f => f.classList.remove('active', 'btn-primary'));
            galleryFilters.forEach(f => f.classList.add('btn-outline-primary'));
            this.classList.remove('btn-outline-primary');
            this.classList.add('active', 'btn-primary');
            
            // Filter items
            let visibleItemsCount = 0;
            galleryItems.forEach(item => {
                if (filterValue === 'all' || item.dataset.category === filterValue) {
                    item.style.display = 'block';
                    item.classList.add('fade-in');
                    visibleItemsCount++;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Update count and show/hide no results
            visibleCount.textContent = visibleItemsCount;
            if (visibleItemsCount === 0) {
                noResults.style.display = 'block';
            } else {
                noResults.style.display = 'none';
            }
        });
    });
    
    // Gallery hover effects
    const galleryCards = document.querySelectorAll('.gallery-card');
    galleryCards.forEach(card => {
        const overlay = card.querySelector('.gallery-overlay');
        const image = card.querySelector('.gallery-image');
        
        card.addEventListener('mouseenter', function() {
            image.style.transform = 'scale(1.1)';
            image.style.transition = 'transform 0.3s ease';
            overlay.style.background = 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.2))';
            overlay.style.transition = 'background 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            image.style.transform = 'scale(1)';
            overlay.style.background = 'linear-gradient(to top, rgba(0,0,0,0.6), transparent)';
        });
    });
    
    // Initialize overlay styles
    galleryCards.forEach(card => {
        const overlay = card.querySelector('.gallery-overlay');
        overlay.style.background = 'linear-gradient(to top, rgba(0,0,0,0.6), transparent)';
    });
});

// Lightbox functionality
function openLightbox(imageSrc, title, description) {
    document.getElementById('lightboxImage').src = imageSrc;
    document.getElementById('lightboxTitle').textContent = title;
    document.getElementById('lightboxDescription').textContent = description || '';
    
    const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
    modal.show();
}

// Keyboard navigation for lightbox
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('lightboxModal');
    if (modal.classList.contains('show')) {
        if (e.key === 'Escape') {
            bootstrap.Modal.getInstance(modal).hide();
        }
    }
});
</script>
{% endblock %}
