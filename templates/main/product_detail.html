{% extends "base.html" %}

{% block title %}{{ product.get_name(current_language) }} - {{ product.category.get_name(current_language) }} - {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) or (product.get_description(current_language) if product.get_description is defined else product.get_description()) | truncate(160) }}{% endblock %}

{% block og_title %}{{ product.get_name(current_language) }} - {{ _('Premium Egyptian') }} {{ product.category.get_name(current_language) }}{% endblock %}
{% block og_description %}{{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) or (product.get_description(current_language) if product.get_description is defined else product.get_description()) | truncate(160) }}{% endblock %}
{% block og_image %}
{% set main_image = product.get_main_image() %}
{% if main_image %}
{{ url_for('main.uploaded_file', filename='products/' + main_image.filename, _external=True) }}
{% elif product.image_path %}
{{ url_for('static', filename=product.image_path.replace('static/', ''), _external=True) }}
{% else %}
{{ super() }}
{% endif %}
{% endblock %}

{% block content %}
<!-- Product Header (green hero like products page) -->
<section class="py-5 product-hero position-relative overflow-hidden" style="background:#689b8a;">
  <style>
    .product-hero .section-badge { background: var(--secondary-gradient) !important; color: var(--dark-color) !important; }
    .product-hero .breadcrumb, .product-hero .breadcrumb * { color: rgba(255,255,255,.85) !important; }
    .product-hero .product-title { color:#fff !important; }
    .product-hero .lead { color:#fff !important; opacity:.9; }
    .product-hero .pattern-dots { color: rgba(255,255,255,.15); }
    /* hero bubbles */
    .ph-animated { position:absolute; inset:0; pointer-events:none; }
    .ph-bubble{ position:absolute; border-radius:50%; background: rgba(255,255,255,.18); filter: blur(.4px); animation: phFloat 12s ease-in-out infinite; }
    .ph-b1{ width:90px; height:90px; top:12%; left:10%; }
    .ph-b2{ width:140px; height:140px; bottom:10%; right:12%; animation-direction: reverse; animation-duration: 14s; }
    .ph-b3{ width:70px; height:70px; top:35%; right:28%; animation-duration: 11s; }
    @keyframes phFloat { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-14px);} }
    @media (max-width: 767.98px){ .ph-animated{ display:none !important; } }
  </style>
  <div class="position-absolute top-0 start-0 w-100 h-100"><div class="pattern-dots opacity-25"></div></div>
  <div class="ph-animated" aria-hidden="true">
    <span class="ph-bubble ph-b1"></span>
    <span class="ph-bubble ph-b2"></span>
    <span class="ph-bubble ph-b3"></span>
  </div>
  <div class="container position-relative">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">{% if is_rtl %}الرئيسية{% else %}{{ _('Home') }}{% endif %}</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('main.products') }}">{% if is_rtl %}المنتجات{% else %}{{ _('Products') }}{% endif %}</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('main.products', cat=product.category.key) }}">{{ product.category.get_name(current_language) }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ product.get_name(current_language) }}</li>
      </ol>
    </nav>
    <div class="mt-3">
      <div class="section-badge badge px-4 py-2 rounded-pill mb-3 fs-6 fw-semibold">
        <i class="fas fa-apple-alt me-2"></i>{{ product.category.get_name(current_language) }}
      </div>
      <h1 class="product-title {{ 'arabic-heading' if is_rtl else 'english-heading' }} mb-2">{{ product.get_name(current_language) }}</h1>
      {% if product.get_short_description %}
      <p class="lead {{ 'arabic-text' if is_rtl else 'english-text' }} mb-0">{{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) or '' }}</p>
      {% endif %}
    </div>
  </div>
</section>


<!-- Unified CTA button style (applies to all products) -->
<style>
  .btn-green-to-peach {
    border: 2px solid var(--brand-green, #689b8a);
    background: var(--brand-green, #689b8a);
    color: #fff;
    border-radius: 12px;
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease, border-color .2s ease;
  }
  .btn-green-to-peach:hover,
  .btn-green-to-peach:focus,
  .btn-green-to-peach:active {
    background: var(--secondary-gradient);
    color: var(--dark-color);
    border-color: transparent;
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(249,203,153,.35);
  }
</style>

<!-- Product Details -->

<style>
  /* Floating leaves like products page */
  .grid-animated-bg { position:absolute; inset:0; z-index:0; pointer-events:none; }
  .leaf { position:absolute; color: rgba(249,203,153,.55); font-size: 1rem; animation: leafDrift 18s linear infinite; }
  .leaf.l1 { top:10%; left:-40px; animation-duration: 18s; }
  .leaf.l2 { top:20%; left:-60px; animation-duration: 20s; animation-delay: 3s; }
  .leaf.l3 { top:35%; left:-50px; animation-duration: 22s; animation-delay: 6s; }
  .leaf.l4 { top:55%; left:-70px; animation-duration: 24s; animation-delay: 2s; }
  .leaf.l5 { top:75%; left:-45px; animation-duration: 26s; animation-delay: 5s; }
  .leaf.l6 { top:85%; left:-80px; animation-duration: 28s; animation-delay: 7s; }
  @keyframes leafDrift { 0%{ transform: translateX(0) rotate(0deg);} 50%{ transform: translateX(50vw) rotate(10deg);} 100%{ transform: translateX(100vw) rotate(0deg);} }
  @media (max-width: 767.98px){ .grid-animated-bg{ display:none !important; } }
</style>


<section class="py-5 position-relative overflow-hidden">
    <div class="container">
        <div class="row">
            <!-- Product Images -->
<div class="grid-animated-bg" aria-hidden="true">
  <i class="fas fa-leaf leaf l1"></i>
  <i class="fas fa-leaf leaf l2"></i>
  <i class="fas fa-leaf leaf l3"></i>
  <i class="fas fa-leaf leaf l4"></i>
  <i class="fas fa-leaf leaf l5"></i>
  <i class="fas fa-leaf leaf l6"></i>
</div>

            <div class="col-lg-6 mb-4">
                <div class="product-images position-relative">
                    <!-- Main Image -->

<style>
  /* Product image hover effects and on-image leaves */
  .product-image-wrapper { border-radius: 22px; overflow: hidden; transition: border-radius .35s ease, box-shadow .35s ease; }
  .product-image-wrapper:hover { border-radius: 28px; box-shadow: 0 20px 40px rgba(0,0,0,.12); }
  .product-image-wrapper img.product-image { transition: transform .5s ease, filter .5s ease; will-change: transform; }
  .product-image-wrapper:hover img.product-image { transform: scale(1.06); filter: saturate(1.04) contrast(1.03); }
  /* Leaves overlay inside the image */
  .image-leaves { position:absolute; inset:0; z-index:2; pointer-events:none; }
  .img-leaf { position:absolute; color: rgba(249,203,153,.75); opacity: 0; font-size: 14px; animation: imgLeafDrift 16s linear infinite; filter: drop-shadow(0 2px 2px rgba(0,0,0,.1)); }
  .img-leaf.i1 { top: 8%; left: -12%; animation-delay: 0s; }
  .img-leaf.i2 { top: 28%; left: -16%; animation-delay: 1.5s; }
  .img-leaf.i3 { top: 46%; left: -14%; animation-delay: 3s; }
  .img-leaf.i4 { top: 65%; left: -18%; animation-delay: 4.5s; font-size: 12px; opacity:.9; }
  .img-leaf.i5 { top: 20%; left: -20%; animation-delay: 2.2s; font-size: 16px; }
  .img-leaf.i6 { top: 80%; left: -22%; animation-delay: 5.5s; font-size: 12px; }
  .img-leaf.i7 { top: 38%; left: -24%; animation-delay: 6.8s; font-size: 15px; }
  .img-leaf.i8 { top: 58%; left: -26%; animation-delay: 7.5s; font-size: 13px; }
  @keyframes imgLeafDrift {
    0% { transform: translateX(0) rotate(0deg); opacity: 0; }
    8% { opacity: .95; }
    50% { transform: translateX(60%) rotate(10deg); }
    100% { transform: translateX(120%) rotate(0deg); opacity: 0; }
  }
  @media (max-width: 575.98px) {
    .product-image-wrapper img.product-image { height: 320px; }
  }
</style>

                    <div class="main-image mb-3 product-image-wrapper position-relative overflow-hidden">
                        {% set main_image = product.get_main_image() %}
                        {% if main_image %}
                        <img id="mainProductImage"
                             src="{{ url_for('main.uploaded_file', filename='products/' + main_image.filename) }}"
                             alt="{{ product.get_name(current_language) }}"
                             class="img-fluid rounded shadow product-image"
                             style="width: 100%; height: 400px; object-fit: cover; cursor: pointer;"
                             onclick="openImageModal(this.src, '{{ product.get_name(current_language) }}')">
                        {% elif product.image_path %}
                        <img id="mainProductImage"
                             src="{{ url_for('static', filename=product.image_path.replace('static/', '')) }}"
                             alt="{{ product.get_name(current_language) }}"
                             class="img-fluid rounded shadow product-image"
                             style="width: 100%; height: 400px; object-fit: cover; cursor: pointer;"
                             onclick="openImageModal(this.src, '{{ product.get_name(current_language) }}')">
                        {% else %}
                        <div class="product-image-wrapper position-relative overflow-hidden rounded shadow" style="height: 400px;">
                            <div class="card-img-top bg-gradient-primary d-flex align-items-center justify-content-center w-100 h-100"><i class="fas fa-apple-alt fa-4x text-white opacity-90"></i></div>
                        <div class="image-leaves" aria-hidden="true">
                          <i class="fas fa-leaf img-leaf i1"></i>
                          <i class="fas fa-leaf img-leaf i2"></i>
                          <i class="fas fa-leaf img-leaf i3"></i>
                          <i class="fas fa-leaf img-leaf i4"></i>
                          <i class="fas fa-leaf img-leaf i5"></i>
                          <i class="fas fa-leaf img-leaf i6"></i>
                          <i class="fas fa-leaf img-leaf i7"></i>
                          <i class="fas fa-leaf img-leaf i8"></i>
                        </div>

                        </div>
                        {% endif %}
                    </div>

                    <!-- Thumbnail Gallery -->
                    {% if product.images.count() > 1 %}
                    <div class="thumbnail-gallery">
                        <div class="row g-2">
                            {% for image in product.images %}
                            <div class="col-3">
                                <img src="{{ url_for('main.uploaded_file', filename='products/' + image.filename) }}"
                                     alt="{{ image.get_alt_text() }}"
                                     class="img-fluid rounded thumbnail-image"
                                     style="height: 80px; object-fit: cover; cursor: pointer;"
                                     onclick="changeMainImage(this.src)">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Product Information -->
            <div class="col-lg-6">
                <div class="product-info">
                    <!-- Category Badge -->
                    <div class="mb-3">
                        <span class="badge bg-gradient-secondary text-dark fs-6">{{ product.category.get_name(current_language) }}</span>
                        {% if product.featured %}
                        <span class="badge bg-warning text-dark ms-2">{% if is_rtl %}مميز{% else %}{{ _('Featured') }}{% endif %}</span>
                        {% endif %}
                    </div>

                    <!-- Product Name -->
                    <h1 class="display-6 fw-bold mb-3 {{ 'arabic-heading' if is_rtl else 'english-heading' }}">{{ product.get_name(current_language) }}</h1>

                    <!-- Short Description -->
                    {% if product.get_short_description() or (product.get_short_description is defined and product.get_short_description(current_language)) %}
                    <p class="lead text-muted mb-4 {{ 'arabic-text' if is_rtl else 'english-text' }}">{{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) }}</p>
                    {% endif %}



                    <!-- Key Features -->
                    {% set specs = product.get_specifications_lang(current_language) %}
                    {% if specs %}
                    <div class="key-features mb-4">
                        <h5 class="mb-3">{% if is_rtl %}المميزات الرئيسية{% else %}{{ _('Key Features') }}{% endif %}</h5>
                        <div class="row">
                            {% if specs.get('sizes') %}
                            <div class="col-md-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-ruler text-primary me-2"></i>
                                    <span class="small">{% if is_rtl %}مقاسات متعددة متاحة{% else %}{{ _('Multiple Sizes Available') }}{% endif %}</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if specs.get('brix') %}
                            <div class="col-md-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-tint text-success me-2"></i>
                                    <span class="small">{{ specs.brix }} Brix</span>
                                </div>
                            </div>
                            {% endif %}
                            {% if specs.get('acidity') %}
                            <div class="col-md-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-flask text-info me-2"></i>
                                    <span class="small">{{ specs.acidity }} Acidity</span>
                                </div>
                            </div>
                            {% endif %}
                            <div class="col-md-6 mb-2">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-certificate text-warning me-2"></i>
                                    <span class="small">{% if is_rtl %}جودة معتمدة{% else %}{{ _('Certified Quality') }}{% endif %}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div class="action-buttons mb-4">
                        <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-primary btn-lg me-3 hover-lift" style="border-radius: 12px;">
                            <i class="fas fa-envelope me-2"></i>{% if is_rtl %}اطلب عرض سعر{% else %}{{ _('Request Quote') }}{% endif %}
                        </a>
                        <button class="btn btn-outline-secondary hover-lift" onclick="shareProduct()">
                            <i class="fas fa-share-alt me-2"></i>{% if is_rtl %}مشاركة{% else %}{{ _('Share') }}{% endif %}
                        </button>
                    </div>

                    <!-- Quick Info -->
                    <div class="quick-info">
                        <div class="row">
                            <div class="col-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted mb-1">{% if is_rtl %}الفئة{% else %}{{ _('Category') }}{% endif %}</h6>
                                    <p class="mb-0">{{ product.category.get_name(current_language) }}</p>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted mb-1">{% if is_rtl %}المنشأ{% else %}{{ _('Origin') }}{% endif %}</h6>
                                    <p class="mb-0">{% if is_rtl %}مصر{% else %}{{ _('Egypt') }}{% endif %}</p>
                                </div>
                            </div>
                            {% if product.get_hs_code_formatted() %}
                            <div class="col-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted mb-1">{% if is_rtl %}رمز HS{% else %}{{ _('HS Code') }}{% endif %}</h6>
                                    <p class="mb-0">
                                        <span class="badge bg-light text-dark border fw-normal">
                                            <i class="fas fa-barcode me-1"></i>{{ product.get_hs_code_formatted() }}
                                        </span>
                                    </p>
                                </div>
                            </div>
                            {% endif %}
                            {% set seasonality = product.get_seasonality_lang(current_language) %}
                            {% if seasonality.get('harvest') %}
                            <div class="col-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted mb-1">{% if is_rtl %}موسم الحصاد{% else %}{{ _('Harvest Season') }}{% endif %}</h6>
                                    <p class="mb-0">{{ seasonality.harvest }}</p>
                                </div>
                            </div>
                            {% endif %}
                            {% if seasonality.get('peak') %}
                            <div class="col-6">
                                <div class="info-item mb-3">
                                    <h6 class="text-muted mb-1">{% if is_rtl %}موسم الذروة{% else %}{{ _('Peak Season') }}{% endif %}</h6>
                                    <p class="mb-0">{{ seasonality.peak }}</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Monthly Availability Section -->
{% if season_view %}
<section class="py-4 bg-white border-bottom">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="monthly-availability-card">
                    <div class="d-flex align-items-center justify-content-center gap-2 mb-3">
                        <i class="fas fa-calendar-alt text-primary"></i>
                        <h5 class="mb-0 text-primary fw-bold">
                            {% if is_rtl %}
                                التوفر الشهري
                            {% else %}
                                Monthly Availability
                            {% endif %}
                        </h5>
                    </div>

                    <!-- Months Grid -->
                    <div class="months-grid">
                        {% set labels_en = {'peak':'Peak','available':'Available','limited':'Limited','off':'Off-season','iqf':'Frozen'} %}
                        {% set labels_ar = {'peak':'ذروة','available':'متاح','limited':'محدود','off':'خارج الموسم','iqf':'مجمّد'} %}
                        {% set months_names_en = ['January','February','March','April','May','June','July','August','September','October','November','December'] %}
                        {% set months_names_ar = ['يناير','فبراير','مارس','أبريل','مايو','يونيو','يوليو','أغسطس','سبتمبر','أكتوبر','نوفمبر','ديسمبر'] %}
                        {% set months_short_en = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'] %}
                        {% set months_short_ar = ['يناير','فبراير','مارس','أبريل','مايو','يونيو','يوليو','أغسطس','سبتمبر','أكتوبر','نوفمبر','ديسمبر'] %}

                        <div class="months-row d-flex gap-1 justify-content-center flex-nowrap">
                            {% for st in season_view.months_state %}
                                {% set idx = loop.index0 %}
                                {% set label = (labels_ar if is_rtl else labels_en)[st] %}
                                {% set m_name_full = months_names_ar[idx] if is_rtl else months_names_en[idx] %}
                                {% set m_name_short = months_short_ar[idx] if is_rtl else months_short_en[idx] %}

                                <div class="month-item">
                                    <div class="month-card-compact month-{{ st }} text-center p-2 rounded-2 border d-flex flex-column align-items-center justify-content-center"
                                         title="{{ m_name_full }} - {{ label }}">
                                        <div class="month-name-compact fw-bold small">{{ m_name_short }}</div>
                                        <div class="status-dot status-{{ st }} mt-1"></div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="availability-legend-compact mt-3 pt-2 text-center">
                        <div class="d-flex gap-3 justify-content-center flex-wrap">
                            <div class="d-flex align-items-center gap-1">
                                <span class="legend-dot-small legend-peak"></span>
                                <small>{% if is_rtl %}ذروة{% else %}Peak{% endif %}</small>
                            </div>
                            <div class="d-flex align-items-center gap-1">
                                <span class="legend-dot-small legend-available"></span>
                                <small>{% if is_rtl %}متاح{% else %}Available{% endif %}</small>
                            </div>
                            <div class="d-flex align-items-center gap-1">
                                <span class="legend-dot-small legend-limited"></span>
                                <small>{% if is_rtl %}محدود{% else %}Limited{% endif %}</small>
                            </div>
                            <div class="d-flex align-items-center gap-1">
                                <span class="legend-dot-small legend-off"></span>
                                <small>{% if is_rtl %}خارج الموسم{% else %}Off-season{% endif %}</small>
                            </div>
                            <div class="d-flex align-items-center gap-1">
                                <span class="legend-dot-small legend-iqf"></span>
                                <small>{% if is_rtl %}مجمّد{% else %}Frozen{% endif %}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Product Details Tabs -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <!-- Tab Navigation -->

<style>
  /* Monthly Availability Styling - Compact Version */
  .monthly-availability-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 2px 15px rgba(0,0,0,0.06);
    border: 1px solid rgba(249,203,153,0.2);
  }

  .months-row {
    max-width: 100%;
    overflow-x: auto;
    padding: 0.5rem 0;
    scrollbar-width: thin;
    scrollbar-color: rgba(0,0,0,0.2) transparent;
  }

  .months-row::-webkit-scrollbar {
    height: 4px;
  }

  .months-row::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.05);
    border-radius: 2px;
  }

  .months-row::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.2);
    border-radius: 2px;
  }

  .months-row::-webkit-scrollbar-thumb:hover {
    background: rgba(0,0,0,0.3);
  }

  .month-item {
    flex: 0 0 auto;
    min-width: 60px;
  }

  .month-card-compact {
    background: white;
    transition: all 0.3s ease;
    border: 2px solid #e9ecef;
    min-height: 70px;
    width: 60px;
    cursor: pointer;
  }

  .month-card-compact:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  .month-card-compact.month-peak {
    background: #2c5f4f;
    border-color: #2c5f4f;
    color: white;
  }

  .month-card-compact.month-available {
    background: #689b8a;
    border-color: #689b8a;
    color: white;
  }

  .month-card-compact.month-limited {
    background: #f9cb99;
    border-color: #f9cb99;
    color: #856404;
  }

  .month-card-compact.month-off {
    background: #adb5bd;
    border-color: #adb5bd;
    color: white;
  }

  .month-card-compact.month-iqf {
    background: #5bc0de;
    border-color: #5bc0de;
    color: white;
  }

  .month-name-compact {
    font-size: 0.75rem;
    line-height: 1;
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
  }

  .status-dot.status-peak { background-color: #2c5f4f; }
  .status-dot.status-available { background-color: #689b8a; }
  .status-dot.status-limited { background-color: #f9cb99; }
  .status-dot.status-off { background-color: #adb5bd; }
  .status-dot.status-iqf { background-color: #5bc0de; }

  .availability-legend-compact {
    background: rgba(249,203,153,0.08);
    border-radius: 10px;
    padding: 0.75rem;
  }

  .legend-dot-small {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
  }

  .legend-dot-small.legend-peak { background-color: #2c5f4f; }
  .legend-dot-small.legend-available { background-color: #689b8a; }
  .legend-dot-small.legend-limited { background-color: #f9cb99; }
  .legend-dot-small.legend-off { background-color: #adb5bd; }
  .legend-dot-small.legend-iqf { background-color: #5bc0de; }

  /* Active month card styling - Compact */
  .month-card-compact.active-month {
    transform: translateY(-3px) scale(1.1) !important;
    box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important;
    border-width: 3px !important;
  }

  .month-card-compact.active-month.month-peak {
    box-shadow: 0 6px 20px rgba(44, 95, 79, 0.4) !important;
  }

  .month-card-compact.active-month.month-available {
    box-shadow: 0 6px 20px rgba(104, 155, 138, 0.4) !important;
  }

  .month-card-compact.active-month.month-limited {
    box-shadow: 0 6px 20px rgba(249, 203, 153, 0.4) !important;
  }

  .month-card-compact.active-month.month-off {
    box-shadow: 0 6px 20px rgba(173, 181, 189, 0.4) !important;
  }

  .month-card-compact.active-month.month-iqf {
    box-shadow: 0 6px 20px rgba(91, 192, 222, 0.4) !important;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .monthly-availability-card {
      padding: 1rem;
    }

    .month-card-compact {
      min-height: 60px;
      width: 50px;
    }

    .month-name-compact {
      font-size: 0.7rem;
    }

    .months-row {
      gap: 0.5rem !important;
    }

    .availability-legend-compact {
      padding: 0.5rem;
    }

    .legend-dot-small {
      width: 6px;
      height: 6px;
    }
  }

  @media (max-width: 576px) {
    .month-item {
      min-width: 45px;
    }

    .month-card-compact {
      width: 45px;
      min-height: 55px;
    }
  }

  /* Tabs styling and mobile scroll */
  .product-tabs .nav-link { border-radius: 999px; border: 2px solid transparent; padding: .6rem 1rem; font-weight: 600; color: var(--primary-color); }
  .product-tabs .nav-link.active { background: var(--secondary-gradient); color: var(--dark-color); border-color: transparent; }
  .product-tabs .nav-link:not(.active) { border-color: var(--secondary-color); color: var(--secondary-color); background: rgba(249,203,153,.08); }
  .product-tabs .nav-link:hover { filter: brightness(1.05); }
  .tabs-scroller { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .tabs-scroller::-webkit-scrollbar { height: 6px; }
  .tabs-scroller::-webkit-scrollbar-thumb { background: rgba(0,0,0,.15); border-radius: 3px; }
</style>

<script>
// Monthly Availability Interactive Features - Compact Version
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects and tooltips for month cards
    const monthCards = document.querySelectorAll('.month-card-compact');

    monthCards.forEach(card => {
        // Add click effect
        card.addEventListener('click', function() {
            // Remove active class from all cards
            monthCards.forEach(c => c.classList.remove('active-month'));
            // Add active class to clicked card
            this.classList.add('active-month');

            // Get month info from title attribute
            const title = this.getAttribute('title');
            console.log(`Selected: ${title}`);
        });

        // Add enhanced hover effect
        card.addEventListener('mouseenter', function() {
            if (!this.classList.contains('active-month')) {
                this.style.transform = 'translateY(-2px) scale(1.05)';
            }
        });

        card.addEventListener('mouseleave', function() {
            if (!this.classList.contains('active-month')) {
                this.style.transform = 'translateY(0) scale(1)';
            }
        });
    });

    // Animate cards on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const cards = entry.target.querySelectorAll('.month-card-compact');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 50); // Faster animation for compact version
                });
            }
        });
    }, observerOptions);

    const monthsRow = document.querySelector('.months-row');
    if (monthsRow) {
        // Initially hide cards for animation
        const cards = monthsRow.querySelectorAll('.month-card-compact');
        cards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(10px)';
            card.style.transition = 'all 0.3s ease';
        });

        observer.observe(monthsRow);
    }
});
</script>

                <div class="tabs-scroller product-tabs"><ul class="nav nav-pills nav-fill mb-4 flex-nowrap" id="productTabs" role="tablist" data-aos="fade-up" style="overflow-x:auto; white-space:nowrap; gap:.5rem;">

                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab">
                            <i class="fas fa-info-circle me-2"></i>{% if is_rtl %}الوصف{% else %}{{ _('Description') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specifications-tab" data-bs-toggle="tab" data-bs-target="#specifications" type="button" role="tab">
                            <i class="fas fa-list me-2"></i>{% if is_rtl %}المواصفات{% else %}{{ _('Specifications') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="packaging-tab" data-bs-toggle="tab" data-bs-target="#packaging" type="button" role="tab">
                            <i class="fas fa-box me-2"></i>{% if is_rtl %}التعبئة{% else %}{{ _('Packaging') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="applications-tab" data-bs-toggle="tab" data-bs-target="#applications" type="button" role="tab">
                            <i class="fas fa-lightbulb me-2"></i>{% if is_rtl %}التطبيقات / حالات الاستخدام{% else %}{{ _('Applications / Use Cases') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="quality-tab" data-bs-toggle="tab" data-bs-target="#quality" type="button" role="tab">
                            <i class="fas fa-shield-alt me-2"></i>{% if is_rtl %}الجودة وسلامة الغذاء{% else %}{{ _('Quality & Food Safety') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="commercial-tab" data-bs-toggle="tab" data-bs-target="#commercial" type="button" role="tab">
                            <i class="fas fa-file-contract me-2"></i>{% if is_rtl %}التجاري والوثائق{% else %}{{ _('Commercial & Documentation') }}{% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="certifications-tab" data-bs-toggle="tab" data-bs-target="#certifications" type="button" role="tab">
                            <i class="fas fa-certificate me-2"></i>{% if is_rtl %}الشهادات{% else %}{{ _('Certifications') }}{% endif %}
                        </button>
                    </li>
                </ul></div>

                <!-- Tab Content -->
                <div class="tab-content" id="productTabsContent">
                    <!-- Description Tab -->
                    <div class="tab-pane fade show active" id="description" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                {% if product.get_description() %}
                                    {{ product.get_description(current_language) | safe }}
                                {% else %}
                                    <p>{% if is_rtl %}{{ product.get_name(current_language) }} يمثل أعلى معايير الجودة في المنتجات الزراعية المصرية. نختار منتجاتنا بعناية من أفضل المزارع ونقوم بمعالجتها باستخدام أحدث التقنيات لضمان أقصى درجات النضارة والجودة.{% else %}{{ product.get_name(current_language) }} represents the finest quality Egyptian agricultural produce. Our products are carefully selected from premium farms and processed using state-of-the-art facilities to ensure optimal freshness and quality.{% endif %}</p>

                                    <h5 class="mt-4 mb-3">{% if is_rtl %}ضمان الجودة{% else %}{{ _('Quality Assurance') }}{% endif %}</h5>
                                    <p>{% if is_rtl %}كل دفعة تمر بإجراءات صارمة لمراقبة الجودة وتشمل:{% else %}{{ _('Every batch undergoes rigorous quality control processes including:') }}{% endif %}</p>
                                    <ul>

<style>
  /* Specifications grid polish */
  .spec-item { background: rgba(249,203,153,.06); border: 1px solid rgba(249,203,153,.25); border-radius: 12px; padding: .75rem 1rem; }
</style>

                                        {% if is_rtl %}
                                        <li>فحص بصري للحجم واللون والمظهر</li>
                                        <li>اختبارات معملية للسلامة والقيمة الغذائية</li>
                                        <li>إدارة سلسلة التبريد أثناء المعالجة والتخزين</li>
                                        <li>الالتزام بالمعايير الدولية للتصدير</li>
                                        {% else %}
                                        <li>{{ _('Visual inspection for size, color, and appearance') }}</li>
                                        <li>{{ _('Laboratory testing for safety and nutritional content') }}</li>
                                        <li>{{ _('Cold chain management throughout processing and storage') }}</li>
                                        <li>{{ _('Compliance with international export standards') }}</li>
                                        {% endif %}
                                    </ul>

                                    <h5 class="mt-4 mb-3">{% if is_rtl %}لماذا تختار {{ product.get_name(current_language) }} لدينا؟{% else %}{{ _('Why Choose Our') }} {{ product.get_name(current_language) }}?{% endif %}</h5>
                                    <p>{% if is_rtl %}التزامنا بالتميّز يضمن لك منتجات تلبي أعلى المعايير الدولية مع الحفاظ على الطعم الأصيل والقيمة الغذائية التي تشتهر بها الزراعة المصرية عالمياً.{% else %}{{ _('Our commitment to excellence ensures that you receive products that meet the highest international standards while maintaining the authentic taste and nutritional value that Egyptian agriculture is renowned for worldwide.') }}{% endif %}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Specifications Tab -->
                    <div class="tab-pane fade" id="specifications" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                {% if specs or product.hs_code %}
                                    <!-- Specifications Table -->
                                    <div class="specifications-table">
                                        <table class="table table-borderless">
                                            <tbody>
                                                <!-- Product Name -->
                                                <tr>
                                                    <td class="spec-label">
                                                        <strong>{% if is_rtl %}المنتج{% else %}Product{% endif %}</strong>
                                                    </td>
                                                    <td class="spec-value">
                                                        <span class="text-primary fw-semibold">{{ product.get_name(current_language) }}</span>
                                                        {% if product.category %}
                                                        — {{ product.category.get_name(current_language) }}
                                                        {% endif %}
                                                        {% if product.origin %}
                                                        — {% if is_rtl %}منشأ{% else %}origin{% endif %} {{ product.origin }}
                                                        {% endif %}
                                                    </td>
                                                </tr>

                                                <!-- HS Code -->
                                                {% if product.hs_code %}
                                                <tr>
                                                    <td class="spec-label">
                                                        <strong>{% if is_rtl %}كود النظام المنسق{% else %}HS Code{% endif %}</strong>
                                                    </td>
                                                    <td class="spec-value">
                                                        {% set hs_display = product.get_hs_code_display(current_language) %}
                                                        {% if hs_display %}
                                                            <span class="text-primary">{{ hs_display }}</span>
                                                        {% else %}
                                                            <span class="text-primary">{{ product.hs_code }}</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endif %}

                                                <!-- Dynamic Specifications -->
                                                {% if specs %}
                                                    {% for key, value in specs.items() %}
                                                        {% if key != 'notes' %}
                                                        <tr>
                                                            <td class="spec-label">
                                                                <strong>{{ key.replace('_', ' ').title() }}</strong>
                                                            </td>
                                                            <td class="spec-value">
                                                                {% if value is iterable and value is not string %}
                                                                    {% for item in value %}
                                                                        {{ item }}{% if not loop.last %} • {% endif %}
                                                                    {% endfor %}
                                                                {% else %}
                                                                    {{ value }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endif %}
                                                    {% endfor %}

                                                    <!-- Notes at the bottom -->
                                                    {% if specs.get('notes') %}
                                                    <tr>
                                                        <td colspan="2" class="spec-notes">
                                                            <div class="alert alert-light border-0 mt-3 mb-0">
                                                                <small class="text-muted">{{ specs.notes }}</small>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    {% endif %}
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>

<style>
/* Specifications Table Styling */
.specifications-table {
    background: #fff;
    border-radius: 12px;
    overflow: hidden;
}

.specifications-table .table {
    margin-bottom: 0;
}

.specifications-table tr {
    border-bottom: 1px solid #f8f9fa;
}

.specifications-table tr:last-child {
    border-bottom: none;
}

.spec-label {
    width: 25%;
    padding: 1rem 1.5rem;
    background: #f8f9fa;
    color: #6c757d;
    font-size: 0.9rem;
    vertical-align: top;
    border-right: 1px solid #e9ecef;
}

.spec-value {
    padding: 1rem 1.5rem;
    color: #495057;
    line-height: 1.6;
}

.spec-value .text-primary {
    color: var(--brand-green, #689b8a) !important;
}

.spec-notes {
    padding: 0 1.5rem 1rem;
}

/* RTL Support */
[dir="rtl"] .spec-label {
    border-right: none;
    border-left: 1px solid #e9ecef;
}

/* Responsive */
@media (max-width: 768px) {
    .spec-label {
        width: 35%;
        padding: 0.75rem 1rem;
        font-size: 0.85rem;
    }

    .spec-value {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
    }
}
</style>

                                {% else %}
                                    <div class="text-center py-4">
                                        <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                                        <h5>{% if is_rtl %}المواصفات التفصيلية متاحة{% else %}{{ _('Detailed Specifications Available') }}{% endif %}</h5>
                                        <p class="text-muted">{% if is_rtl %}تواصل معنا للحصول على المواصفات الفنية الكاملة ومعايير الجودة.{% else %}{{ _('Contact us for complete technical specifications and quality parameters.') }}{% endif %}</p>
                                        <a href="{{ url_for('main.contact') }}" class="btn btn-green-to-peach">
                                            <i class="fas fa-envelope me-2"></i>{% if is_rtl %}اطلب المواصفات{% else %}{{ _('Request Specifications') }}{% endif %}
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Packaging Tab -->
                    <div class="tab-pane fade" id="packaging" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                {% set packaging = product.get_packaging_options_lang(current_language) %}
                                {% if packaging %}
                                    <div class="row">
                                        {% for key, value in packaging.items() %}
                                        <div class="col-md-6 mb-4">
                                            <div class="packaging-option">
                                                <h6 class="text-success mb-2">
                                                    <i class="fas fa-box me-2"></i>{{ key.replace('_', ' ').title() }}
                                                </h6>
                                                <p class="text-muted mb-0">{{ value }}</p>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <div class="packaging-option">
                                                <h6 class="text-success mb-2">
                                                    <i class="fas fa-box me-2"></i>{% if is_rtl %}تعبئة بالجملة{% else %}{{ _('Bulk Packaging') }}{% endif %}
                                                </h6>
                                                <p class="text-muted mb-0">{% if is_rtl %}كراتين 15 كجم، 18 كجم، أو أحجام بالجملة مخصصة{% else %}{{ _('15kg cartons, 18kg cartons, or custom bulk sizes') }}{% endif %}</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="packaging-option">
                                                <h6 class="text-success mb-2">
                                                    <i class="fas fa-shopping-bag me-2"></i>{% if is_rtl %}تعبئة تجزئة{% else %}{{ _('Retail Packaging') }}{% endif %}
                                                </h6>
                                                <p class="text-muted mb-0">{% if is_rtl %}عبوات جاهزة للمستهلك 1كجم، 2كجم، 5كجم{% else %}{{ _('1kg, 2kg, 5kg consumer-ready packages') }}{% endif %}</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="packaging-option">
                                                <h6 class="text-success mb-2">
                                                    <i class="fas fa-tags me-2"></i>{% if is_rtl %}ملصقات خاصة بالعلامة التجارية{% else %}{{ _('Private Labeling') }}{% endif %}
                                                </h6>
                                                <p class="text-muted mb-0">{% if is_rtl %}ملصقات مخصصة بعلامتك التجارية ومواصفاتك{% else %}{{ _('Custom labels with your brand and specifications') }}{% endif %}</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <div class="packaging-option">
                                                <h6 class="text-success mb-2">
                                                    <i class="fas fa-thermometer-half me-2"></i>{% if is_rtl %}سلسلة التبريد{% else %}{{ _('Cold Chain') }}{% endif %}
                                                </h6>
                                                <p class="text-muted mb-0">{% if is_rtl %}تعبئة مُحكمة الحرارة لأقصى درجات النضارة{% else %}{{ _('Temperature-controlled packaging for optimal freshness') }}{% endif %}</p>
                                            </div>


                                        </div>
                                    </div>
                                {% endif %}

                                <div class="mt-4 p-3 bg-light rounded">
                                    <h6 class="mb-2">{% if is_rtl %}تعبئة مخصصة متاحة{% else %}{{ _('Custom Packaging Available') }}{% endif %}</h6>
                                    <p class="text-muted mb-0">{% if is_rtl %}نقدّم حلول تعبئة مرنة لتلبية متطلبات سوقك. تواصل معنا لمناقشة الخيارات المخصصة.{% else %}{{ _('We offer flexible packaging solutions to meet your specific market requirements. Contact us to discuss custom options.') }}{% endif %}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Applications / Use Cases Tab -->
                    <div class="tab-pane fade" id="applications" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                {% set apps = product.get_applications_lang(current_language) %}
                                {% if apps %}
                                    <div class="row">
                                        {% for key, value in apps.items() %}
                                            {% if key != 'notes' %}
                                            <div class="col-md-6 mb-4">
                                                <div class="packaging-option">
                                                    <h6 class="text-primary mb-2">
                                                        <i class="fas fa-lightbulb me-2"></i>{{ key.replace('_', ' ').title() }}
                                                    </h6>
                                                    <p class="text-muted mb-0">{{ value }}</p>
                                                </div>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    {% if apps.get('notes') %}
                                        <div class="alert alert-light border-0 mt-2 mb-0"><small class="text-muted">{{ apps.notes }}</small></div>
                                    {% endif %}
                                {% else %}


                                    <div class="text-center py-4">
                                        <i class="fas fa-lightbulb fa-3x text-muted mb-3"></i>
                                        <h5>{% if is_rtl %}تطبيقات متنوعة{% else %}{{ _('Versatile Applications') }}{% endif %}</h5>
                                        <p class="text-muted">{% if is_rtl %}يُستخدم المنتج في صناعات الأغذية والمشروبات والضيافة وغيرها.{% else %}{{ _('Used across food, beverage, culinary, and hospitality industries.') }}{% endif %}</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Quality & Food Safety (typical targets) Tab -->
                    <div class="tab-pane fade" id="quality" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                {% set qt = product.get_quality_targets_lang(current_language) %}
                                {% if qt %}
                                    <div class="row">
                                        {% for key, value in qt.items() %}
                                            {% if key != 'notes' %}
                                            <div class="col-md-6 mb-4">
                                                <div class="packaging-option">
                                                    <h6 class="text-primary mb-2">
                                                        <i class="fas fa-shield-alt me-2"></i>{{ key.replace('_', ' ').title() }}
                                                    </h6>
                                                    <p class="text-muted mb-0">{{ value }}</p>
                                                </div>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    {% if qt.get('notes') %}
                                        <div class="alert alert-light border-0 mt-2 mb-0"><small class="text-muted">{{ qt.notes }}</small></div>
                                    {% endif %}
                                {% else %}
                                    <div class="text-center py-4">
                                        <i class="fas fa-shield-alt fa-3x text-muted mb-3"></i>
                                        <h5>{% if is_rtl %}الجودة وسلامة الغذاء{% else %}{{ _('Quality & Food Safety') }}{% endif %}</h5>
                                        <p class="text-muted">{% if is_rtl %}أهداف نموذجية للميكروبيولوجيا والملوثات وجودة المنتج.{% else %}{{ _('Typical targets for microbiology, contaminants, and product quality.') }}{% endif %}</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>



                    <!-- Certifications Tab -->
                    <div class="tab-pane fade" id="certifications" role="tabpanel" data-aos="fade-up">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-4">
                                <div class="text-center py-4">
                                    <i class="fas fa-award fa-3x text-muted mb-3"></i>
                                    <h5>{% if is_rtl %}جودة معتمدة{% else %}{{ _('Quality Certified') }}{% endif %}</h5>
                                    <p class="text-muted">{% if is_rtl %}هذا المنتج يلبّي المعايير الدولية للجودة والسلامة.{% else %}{{ _('This product meets international quality and safety standards.') }}{% endif %}</p>
                                </div>

                                <style>
                                  .cert-icons-row { display:flex; gap:1.25rem; justify-content:center; align-items:center; flex-wrap:wrap; margin: 0.5rem 0 1.25rem; }
                                  .cert-icon-tile { background: #ffffff; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.06); padding: 18px 22px; display:flex; align-items:center; justify-content:center; flex-direction: column; transition: transform .2s ease, box-shadow .2s ease; }
                                  .cert-circle { width:72px; height:72px; border-radius:50%; background: var(--primary-color); color:#fff; display:flex; align-items:center; justify-content:center; }
                                  .cert-icon-tile:hover { transform: translateY(-4px); box-shadow: 0 12px 28px rgba(0,0,0,.08); }
                                  .cert-icon-tile:hover .cert-circle { background: var(--secondary-color); color: var(--dark-color); }
                                  .cert-label { font-size:.875rem; font-weight:600; color: var(--gray-700); }
                                </style>
                                <div class="cert-icons-row" data-aos="zoom-in">
                                  <div class="cert-icon-tile">
                                    <div class="cert-circle"><i class="fas fa-globe"></i></div>
                                    <div class="cert-label mt-2">{% if is_rtl %}جلوبال جاب{% else %}GlobalG.A.P{% endif %}</div>
                                  </div>
                                  <div class="cert-icon-tile">
                                    <div class="cert-circle"><i class="fas fa-shield-alt"></i></div>
                                    <div class="cert-label mt-2">{% if is_rtl %}هاسب{% else %}HACCP{% endif %}</div>
                                  </div>
                                  <div class="cert-icon-tile">
                                    <div class="cert-circle"><i class="fas fa-moon"></i></div>
                                    <div class="cert-label mt-2">{% if is_rtl %}حلال{% else %}Halal{% endif %}</div>
                                  </div>
                                  <div class="cert-icon-tile">
                                    <div class="cert-circle"><i class="fas fa-certificate"></i></div>
                                    <div class="cert-label mt-2">{% if is_rtl %}ضمان الجودة{% else %}Quality Assurance{% endif %}</div>
                                  </div>
                                </div>

                                {% if product.certifications %}
                                    <div class="row">
                                        {% for cert in product.certifications %}
                                        <div class="col-md-6 mb-4">
                                            <div class="certification-item d-flex align-items-start">
                                                {% if cert.logo_path %}
                                                <img src="{{ url_for('main.uploaded_file', filename='certifications/' + cert.logo_path) }}"
                                                     alt="{{ cert.get_name(current_language) }}" class="me-3" style="width: 50px; height: 50px; object-fit: contain;">
                                                {% else %}
                                                <div class="cert-icon bg-primary text-white rounded d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                                                    <i class="fas fa-certificate"></i>
                                                </div>
                                                {% endif %}
                                                <div>
                                                    <h6 class="mb-1">{{ cert.get_name(current_language) }}</h6>
                                                    <p class="text-muted small mb-0">{{ cert.get_description(current_language) | truncate(100) }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <div class="text-center py-2">
                                        <a href="{{ url_for('main.certifications') }}" class="btn btn-green-to-peach">
                                            <i class="fas fa-certificate me-2"></i>{% if is_rtl %}عرض كل الشهادات{% else %}{{ _('View All Certifications') }}{% endif %}
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
{% if related_products %}
<section class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="mb-3">{% if is_rtl %}منتجات ذات صلة{% else %}{{ _('Related Products') }}{% endif %}</h2>
            <p class="lead text-muted">{% if is_rtl %}المزيد من المنتجات من {{ product.category.get_name(current_language) }}{% else %}{{ _('More products from') }} {{ product.category.get_name(current_language) }}{% endif %}</p>
        </div>

        <div class="row g-4 products-grid">
            {% for related in related_products %}

<style>
  /* Mobile polish similar to products page */
  @media (max-width: 767.98px) {
    .product-hero { padding-top: 2.25rem !important; padding-bottom: 2.25rem !important; }
  }
</style>

            <div class="col-lg-4 col-md-6 col-sm-12 product-col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                <div class="product-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    {% set related_image = related.get_main_image() %}
                    {% if related_image %}
                    <div class="product-image-wrapper position-relative overflow-hidden">
                      <img src="{{ url_for('main.uploaded_file', filename='products/' + related_image.filename) }}"
                           class="card-img-top product-image" alt="{{ related.get_name(current_language) }}" style="height: 200px; object-fit: cover;">
                    </div>
                    {% elif related.image_path %}
                    <div class="product-image-wrapper position-relative overflow-hidden">
                      <img src="{{ url_for('static', filename=related.image_path.replace('static/', '')) }}"
                           class="card-img-top product-image" alt="{{ related.get_name(current_language) }}" style="height: 200px; object-fit: cover;">
                    </div>
                    {% else %}
                    <div class="product-image-wrapper position-relative overflow-hidden" style="height:200px;">
                      <div class="card-img-top bg-gradient-primary d-flex align-items-center justify-content-center w-100 h-100">
                        <i class="fas fa-apple-alt fa-2x text-white opacity-90"></i>
                      </div>
                    </div>
                    {% endif %}

                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title">{{ related.get_name(current_language) }}</h6>

                        {% if related.get_hs_code_formatted() %}
                        <div class="mb-2">
                            <span class="badge bg-light text-dark border fw-normal">
                                <i class="fas fa-barcode me-1"></i>{{ related.get_hs_code_formatted() }}
                            </span>
                        </div>
                        {% endif %}

                        {% set related_short_desc = related.get_short_description(current_language) if related.get_short_description is defined else related.get_short_description() %}
                        <p class="card-text text-muted flex-grow-1">{{ related_short_desc | truncate(80) if related_short_desc else _('Premium quality Egyptian agricultural product.') }}</p>

                        <div class="d-flex gap-2 mt-auto">
                          <a href="{{ url_for('main.product_detail', slug=related.slug) }}" class="btn btn-outline-primary btn-text english-heading flex-grow-1 hover-lift">
                            <i class="fas fa-info-circle me-1"></i>{{ _('Details') }}
                          </a>
                          <a href="{{ url_for('main.contact') }}?product={{ related.slug }}" class="btn btn-primary hover-lift">
                            <i class="fas fa-envelope"></i>
                          </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- CTA Section copied from homepage Partnership Opportunity -->
<section class="py-5 bg-gradient-primary text-white position-relative overflow-hidden">
  <div class="position-absolute top-0 start-0 w-100 h-100">
    <div class="cta-pattern opacity-10"></div>
  </div>
  <div class="container position-relative">
    <div class="row align-items-center">
      <div class="col-lg-8" data-aos="fade-right">
        <div class="cta-badge badge bg-gradient-secondary text-dark px-4 py-2 rounded-pill mb-3 fs-6 fw-semibold">
          <i class="fas fa-handshake me-2"></i>{% if is_rtl %}جاهزون للتعاون{% else %}{{ _('Partnership Opportunity') }}{% endif %}
        </div>
        <h2 class="section-heading {{ 'arabic-heading' if is_rtl else 'english-heading' }} text-shadow" style="color:#ffffff;">
          {% if is_rtl %}هل أنت مهتم بـ <span style="color: var(--secondary-color);">{{ product.get_name(current_language) }}</span>؟{% else %}{{ _('Interested in') }} <span style="color: var(--secondary-color);">{{ product.get_name(current_language) }}</span>?{% endif %}
        </h2>
        <p class="lead mb-4 text-shadow-sm">
          {{ _('Join hundreds of satisfied clients worldwide who trust Emdad Global for their') }}
          {{ _('agricultural sourcing needs. Get a personalized quote today and experience the difference.') }}
        </p>
        <div class="cta-features row g-3 mb-4">
          <div class="col-12">
            <div class="mb-2 d-flex align-items-center justify-content-between small fw-semibold" style="color:#ffffff;">
              <span>{{ _('Quick Response') }}</span>
              <span class="progress-value">100%</span>
            </div>
            <div class="progress" style="height: 10px; background: rgba(255,255,255,0.15);">
              <div class="progress-bar" role="progressbar" style="width: 100%; background: #f9cb99;"></div>
            </div>
          </div>
          <div class="col-12">
            <div class="mb-2 d-flex align-items-center justify-content-between small fw-semibold" style="color:#ffffff;">
              <span>{{ _('Quality Guaranteed') }}</span>
              <span class="progress-value">100%</span>
            </div>
            <div class="progress" style="height: 10px; background: rgba(255,255,255,0.15);">
              <div class="progress-bar" role="progressbar" style="width: 100%; background: #f9cb99;"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4 text-lg-center" data-aos="fade-left" data-aos-delay="200">
        <div class="cta-actions">
          <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-secondary btn-lg px-5 py-3 mb-3 d-block hover-lift">
            <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="line-height:0;">
              <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M20.5 7.5h-6.25l-1.6-2.4a2 2 0 00-1.66-.9H3.5A2.5 2.5 0 001 6.7v10.8A2.5 2.5 0 003.5 20h17a2.5 2.5 0 002.5-2.5v-7a3 3 0 00-2.5-3zm-8.5 0h-1l-.8-1.2c-.09-.14-.24-.3-.45-.3H3.5a.5.5 0 00-.5.5v.5h9.5zM3 8.5h17.5c.83 0 1.5.67 1.5 1.5v7c0 .55-.45 1-1 1H3.5c-.28 0-.5-.22-.5-.5v-9zM6 13.5h5c.28 0 .5.22.5.5s-.22.5-.5.5H6a.5.5 0 010-1zm0 2h9c.28 0 .5.22.5.5s-.22.5-.5.5H6a.5.5 0 010-1z"/></svg>
            </span>{% if is_rtl %}اطلب عرض سعر{% else %}{{ _('Request a Quote') }}{% endif %}
          </a>
          <a href="{{ url_for('main.products') }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift">
            <i class="fas fa-leaf me-2"></i>{% if is_rtl %}تصفح المنتجات{% else %}{{ _('Browse Products') }}{% endif %}
          </a>
          <div class="contact-info mt-4 p-3 glass-effect rounded-3">
            <a href="tel:{{ COMPANY_PHONE }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift mb-3" style="border: 2px solid white; color: white; font-weight: 600; backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1);">
              <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="color: #f9cb99; line-height:0;">
                <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V21c0 .55-.45 1-1 1C10.07 22 2 13.93 2 3c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.24.2 2.45.57 3.57.11.35.03.74-.24 1.02l-2.2 2.2z"/></svg>
              </span>
              <span class="fw-semibold" style="color:#ffffff;">{{ COMPANY_PHONE or '+20-xxx-xxx-xxxx' }}</span>
            </a>
            <a href="mailto:{{ COMPANY_EMAIL }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift" style="border: 2px solid white; color: white; font-weight: 600; backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1);">
              <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="color: #f9cb99; line-height:0;">
                <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M2 5h20v14H2V5zm10 7L3.5 7h17L12 12z"/></svg>
              </span>
              <span class="fw-semibold" style="color:#ffffff;">{{ COMPANY_EMAIL or 'info@emdadglobal.com' }}</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Image gallery functionality
function changeMainImage(src) {
    document.getElementById('mainProductImage').src = src;
}

function openImageModal(src, title) {
    // Create and show image modal (reuse from gallery)
    if (typeof showImageModal === 'function') {
        showImageModal(src, title);
    }
}

// Product sharing
function shareProduct() {
    if (navigator.share) {
        navigator.share({
            title: '{{ product.get_name(current_language) }} - {{ SITE_NAME }}',
            text: '{{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) | truncate(100) }}',
            url: window.location.href
        });
    } else {
        // Fallback to copy link
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Product link copied to clipboard!');
        });
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to related product cards
    const productCards = document.querySelectorAll('.product-card');
    productCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Thumbnail hover effects
    const thumbnails = document.querySelectorAll('.thumbnail-image');
    thumbnails.forEach(thumb => {
        thumb.addEventListener('mouseenter', function() {
            this.style.opacity = '0.7';
            this.style.transform = 'scale(1.05)';
            this.style.transition = 'all 0.3s ease';
        });

        thumb.addEventListener('mouseleave', function() {
            this.style.opacity = '1';
            this.style.transform = 'scale(1)';
        });
    });
});
</script>
{% endblock %}
