{% extends "base.html" %}

{% block title %}
{% if selected_category %}
{{ selected_category.get_name(current_language) if selected_category else '' }} - {% if is_rtl %}المنتجات{% else %}{{ _('Products') }}{% endif %} - {{ SITE_NAME }}
{% else %}
{% if is_rtl %}كل المنتجات{% else %}{{ _('All Products') }}{% endif %} - {{ SITE_NAME }}
{% endif %}
{% endblock %}

{% block meta_description %}
{% if selected_category %}
{% if is_rtl %}استكشف أفضل منتجات {{ selected_category.get_name(current_language).lower() }} من مصر. {{ selected_category.get_description() }}{% else %}{{ _('Explore our premium') }} {{ selected_category.get_name(current_language).lower() }} {{ _('from Egypt.') }} {{ selected_category.get_description() }}{% endif %}
{% else %}
Browse our complete range of premium Egyptian agricultural products including citrus fruits, fresh fruits, vegetables, and frozen products.
{% endif %}
{% endblock %}

{% block content %}
<!-- Page Header (styled like site sections) -->
<section class="py-5 products-hero position-relative overflow-hidden" style="background:#689b8a;">
    <style>
      .products-hero { min-height: 420px; }
      .products-hero .section-heading, .products-hero .lead { color:#fff !important; }
      .products-hero .breadcrumb, .products-hero .breadcrumb * { color:rgba(255,255,255,0.85) !important; }
      .products-hero .section-badge { background: var(--secondary-gradient) !important; color: var(--dark-color) !important; }
      .products-hero .pattern-dots { color: rgba(255,255,255,.15); }
    </style>
            <style>
              .products-hero .section-heading { color:#fff !important; }
            </style>

    <!-- Background Elements -->
    <div class="position-absolute top-0 start-0 w-100 h-100">
        <div class="pattern-dots opacity-25"></div>
    </div>

    <!-- START_PRODUCTS_ANIMATIONS (reversible: say "تراجع" to remove) -->
    <style>
      /* Hero animated bubbles */
      .hero-animated-bg { position:absolute; inset:0; z-index:0; pointer-events:none; }
      .hero-bubble { position:absolute; border-radius:50%; background: rgba(255,255,255,.18); filter: blur(.4px); animation: heroFloat 10s ease-in-out infinite; }
      .hero-bubble.b1 { width:90px; height:90px; top:12%; left:10%; animation-duration: 12s; }
      .hero-bubble.b2 { width:140px; height:140px; bottom:10%; right:12%; animation-duration: 14s; animation-direction: reverse; }
      .hero-bubble.b3 { width:70px; height:70px; top:35%; right:28%; animation-duration: 11s; }
      .hero-bubble.b4 { width:110px; height:110px; bottom:20%; left:22%; animation-duration: 13s; }
      @keyframes heroFloat { 0%,100%{ transform: translateY(0);} 50%{ transform: translateY(-14px);} }

      /* Grid floating leaves */
      .grid-animated-bg { position:absolute; inset:0; z-index:0; pointer-events:none; }
      .leaf { position:absolute; color: rgba(249,203,153,.55); font-size: 1rem; animation: leafDrift 18s linear infinite; }
      .leaf.l1 { top:10%; left:-40px; animation-duration: 18s; }
      .leaf.l2 { top:40%; left:-60px; animation-duration: 20s; animation-delay: 3s; }
      .leaf.l3 { top:70%; left:-50px; animation-duration: 22s; animation-delay: 6s; }
      @keyframes leafDrift { 0%{ transform: translateX(0) rotate(0deg);} 50%{ transform: translateX(50vw) rotate(10deg);} 100%{ transform: translateX(100vw) rotate(0deg);} }

      /* Decoration glow on hover */
      .product-card:hover .decoration-circle { box-shadow: 0 0 0 10px rgba(104,155,138,.08), 0 0 25px rgba(249,203,153,.45); }
  /* Mini season chips */
  .state-chip { display:inline-block; width: 14px; height: 10px; border-radius: 6px; border:1px solid transparent; box-shadow: inset 0 1px 0 rgba(255,255,255,.28); }
  .state-chip.state-peak{ background:linear-gradient(180deg,#2c5f4f,#244d40); border-color:#244d40; }
  .state-chip.state-available{ background:linear-gradient(180deg,#689b8a,#567f72); border-color:#567f72; }
  .state-chip.state-limited{ background:linear-gradient(180deg,#f9cb99,#f4b56f); border-color:#f4b56f; }
  .state-chip.state-off{ background:linear-gradient(180deg,#adb5bd,#8f9aa3); border-color:#8f9aa3; }
  .state-chip.state-iqf{ background:linear-gradient(180deg,#5bc0de,#3aa9c7); border-color:#3aa9c7; }

      /* Ripple effect for filter buttons */
      .category-filter .btn { position: relative; overflow: hidden; }
      .btn-ripple { position:absolute; border-radius:50%; transform: translate(-50%,-50%); pointer-events:none; width:10px; height:10px; background: rgba(249,203,153,.45); animation: rippleOut .6s ease-out forwards; }
      @keyframes rippleOut { to { opacity:0; width:220px; height:220px; } }

      /* Image skeleton shimmer */
      .img-skeleton { position:relative; background: linear-gradient(90deg, rgba(0,0,0,.06), rgba(255,255,255,.15), rgba(0,0,0,.06)); background-size: 200% 100%; animation: shimmer 1.2s linear infinite; }
      @keyframes shimmer { 0%{ background-position: 200% 0;} 100%{ background-position: -200% 0;} }

      /* Reduced motion: minimize animations */
      @media (prefers-reduced-motion: reduce) {
        .hero-bubble, .leaf { animation: none !important; }
      }
    </style>

    <!-- Animated layer in hero -->
    <div class="hero-animated-bg" aria-hidden="true">

<style>
  /* Prevent overlays from covering content on small screens */
  @media (max-width: 991.98px) {
    .product-overlay { opacity: 1; background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.35)); }
    .overlay-content .btn { padding: .35rem .6rem; font-size: .85rem; }
  }
  @media (max-width: 575.98px) {
    .product-card { border-radius: 16px; }
    .product-image-wrapper { border-top-left-radius: 16px; border-top-right-radius: 16px; }
    .product-card .card-body { padding: 1rem !important; }
    .product-col { padding-left: .5rem; padding-right: .5rem; }
  }
</style>

      <span class="hero-bubble b1"></span>
      <span class="hero-bubble b2"></span>
      <span class="hero-bubble b3"></span>
      <span class="hero-bubble b4"></span>
    </div>
    <!-- Leaves layer -->
    <div class="grid-animated-bg" aria-hidden="true" id="productsHeroLeaves"></div>
    <!-- END_PRODUCTS_ANIMATIONS -->

    <!-- Reverse drift keyframes for right-to-left movement -->
    <style>
      @keyframes leafDriftReverse { 0%{ transform: translateX(0) rotate(0deg);} 50%{ transform: translateX(-50vw) rotate(-10deg);} 100%{ transform: translateX(-100vw) rotate(0deg);} }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const container = document.getElementById('productsHeroLeaves');
        if(!container) return;
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (prefersReduced) return;
        const COUNT = 12; // reduced slightly, still lively
        for (let i = 0; i < COUNT; i++) {
          const leaf = document.createElement('i');
          leaf.className = 'fas fa-leaf leaf';
          // random vertical position
          const top = (Math.random() * 92) + 2; // 2%..94%
          leaf.style.top = top.toFixed(2) + '%';
          // random side and drift direction
          const fromLeft = Math.random() < 0.5;
          const offset = -30 - Math.random() * 70; // -30..-100px
          if (fromLeft) { leaf.style.left = offset.toFixed(0) + 'px'; leaf.style.animationName = 'leafDrift'; }
          else { leaf.style.right = offset.toFixed(0) + 'px'; leaf.style.animationName = 'leafDriftReverse'; }
          // random speed and delay
          const duration = 16 + Math.random() * 12; // 16..28s
          leaf.style.animationDuration = duration.toFixed(2) + 's';
          const delay = Math.random() * 10; // 0..10s
          leaf.style.animationDelay = delay.toFixed(2) + 's';
          // random size
          const size = 0.8 + Math.random() * 0.9; // 0.8..1.7rem
          leaf.style.fontSize = size.toFixed(2) + 'rem';
          container.appendChild(leaf);
        }
      });
    </script>



<style>
  /* Mobile fixes for animated layers */
  @media (max-width: 767.98px) {
    .hero-animated-bg { display: none !important; }
    .grid-animated-bg { display: none !important; }
    .products-hero { padding-top: 2.25rem !important; padding-bottom: 2.25rem !important; min-height: 300px; }
  }
</style>

    <div class="container position-relative">
        <div class="row align-items-center g-4">
            <div class="col-lg-8" data-aos="fade-right">
                <div class="mb-3">
                    <div class="section-badge badge bg-gradient-primary text-white px-4 py-2 rounded-pill mb-3 fs-6 fw-semibold">
                        <i class="fas fa-seedling me-2"></i>{% if is_rtl %}منتجاتنا{% else %}{{ _('Our Products') }}{% endif %}
                    </div>
                    <h1 class="section-heading english-heading mb-3">
                        {% if selected_category %}
                            {{ selected_category.get_name(current_language) if selected_category else '' }}
                        {% else %}
                            {% if is_rtl %}تشكيلة منتجاتنا المتميزة{% else %}{{ _('Our Premium Product Range') }}{% endif %}
                        {% endif %}
                    </h1>
                    <p class="lead english-text text-muted">
                        {% if selected_category %}
                            {{ selected_category.get_description(current_language) }}
                        {% else %}
                            {% if is_rtl %}
                                استكشف تشكيلتنا المختارة بعناية من المنتجات الزراعية المصرية، حيث تلتقي الجودة العالية بالمذاق الأصيل والمعايير الدولية.
                            {% else %}
                                {{ _('Discover our carefully curated selection of Egyptian agricultural products, each representing the finest quality and authentic taste.') }}
                            {% endif %}
                        {% endif %}
                    </p>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end" data-aos="fade-left">
                <a href="{{ url_for('main.contact') }}" class="btn btn-primary btn-lg px-4 py-3 hover-lift" style="border-radius: 12px;">
                    <i class="fas fa-envelope me-2"></i>{% if is_rtl %}اطلب عرض سعر{% else %}{{ _('Request Quote') }}{% endif %}
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Category Filter -->

<style>
  .category-filter .btn { border-radius: 999px; padding: .5rem 1rem; font-weight: 600; }
  .category-filter .btn-outline-primary { border-color: var(--secondary-color); color: var(--secondary-color); background: rgba(249,203,153,.1); }
  .category-filter .btn-outline-primary:hover { background: var(--secondary-gradient); color: var(--dark-color); }
  .category-filter .btn-primary { background: var(--secondary-gradient); border-color: transparent; color: var(--dark-color); }
  @media (max-width: 576px) {
    .category-filter .btn { padding: .4rem .75rem; font-size: .9rem; }
  }
</style>

<section class="py-4 bg-white border-bottom position-relative overflow-hidden category-filter-section">
                <!-- Floating leaves background -->
                <div class="grid-animated-bg" aria-hidden="true">
                  <i class="fas fa-leaf leaf l1"></i>
                  <i class="fas fa-leaf leaf l2"></i>
                  <i class="fas fa-leaf leaf l3"></i>
                </div>

    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex flex-wrap gap-2 category-filter">
                    <a href="{{ url_for('main.products') }}"
                       class="btn {% if not selected_category %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        {% if is_rtl %}كل المنتجات{% else %}{{ _('All Products') }}{% endif %}
                    </a>
                    {% for category in categories %}
                    <a href="{{ url_for('main.products', cat=category.key) }}"
                       class="btn {% if selected_category and selected_category.id == category.id %}btn-primary{% else %}btn-outline-primary{% endif %}">
                        {{ category.get_name(current_language) }}
                    </a>
                    {% endfor %}
                </div>
            </div>

            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <span class="text-muted">
                    {% if is_rtl %}
                        {% set shown = (products.items|length) if products.items else 0 %}
                        {% set total = products.total if products.total else 0 %}
                        {% set noun = 'منتج' if total == 1 else 'منتجات' %}
                        عرض {{ shown }} من {{ total }} {{ noun }}
                    {% else %}
                        {{ _('Showing') }} {{ (products.items|length) if products.items else 0 }} {{ _('of') }} {{ products.total if products.total else 0 }} {{ _('products') }}
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Products Grid -->

<!-- START_PRODUCTS_GRID_RESTYLE (reversible: say "تراجع" to remove) -->
<style>
  .product-card { border-radius: 20px; overflow: hidden; transition: transform .3s ease, box-shadow .3s ease; }
  .product-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,.15); }
  .product-image-wrapper { position: relative; overflow: hidden; border-top-left-radius: 20px; border-top-right-radius: 20px; }
  .product-overlay { opacity: 0; transition: opacity .3s ease, transform .3s ease; transform: scale(.98); background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.35)); }
  .product-card:hover .product-overlay { opacity: 1; transform: scale(1); }
  .product-overlay .btn { border-radius: 12px; }
  .product-category .badge { background: rgba(249, 203, 153, 0.15); color: var(--secondary-color); }
</style>

<section class="py-5">
    <div class="container">
        {% if products and products.items %}
        <div class="row g-4 products-grid">
            {% for product in products.items %}
            <div class="col-lg-4 col-md-6 col-sm-12 product-col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                <div class="product-card card h-100 border-0 shadow-lg hover-lift position-relative overflow-hidden">
                    <!-- Product Image -->
                    {% set main_image = product.get_main_image() %}
                    {% set _fname = main_image.filename if main_image else (product.image_path if product.image_path else (product.slug ~ '-emdad-global.webp')) %}

                    {% if main_image %}
                    <div class="product-image-wrapper position-relative overflow-hidden">
  <img src="{{ url_for('main.uploaded_file', filename='products/' + main_image.filename) }}"
       class="card-img-top" alt="{{ product.get_name(current_language) if product.get_name is defined else product.get_name() }}"
       style="height: 250px; object-fit: cover;">
  <div class="product-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
    <div class="overlay-content text-center text-white">
      <div class="btn-group-vertical">
        <a href="{{ url_for('main.product_detail', slug=product.slug) }}" class="btn btn-light btn-sm mb-2">
          <i class="fas fa-eye me-1"></i>{{ _('Quick View') }}
        </a>
        <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-primary btn-sm">
          <i class="fas fa-envelope me-1"></i>{{ _('Get Quote') }}
        </a>
      </div>
    </div>
  </div>
</div>
                    {% elif product.image_path %}
                    <div class="product-image-wrapper position-relative overflow-hidden">
  <img src="{{ image_url_with_timestamp('products/' + _fname) }}"
       class="card-img-top" alt="{{ product.get_name(current_language) if product.get_name is defined else product.get_name() }}"
       style="height: 250px; object-fit: cover;"
       loading="eager" decoding="async"
       onerror="this.onerror=null; this.closest('.product-image-wrapper')?.insertAdjacentHTML('afterbegin', '<div class=\'card-img-top bg-gradient-primary d-flex align-items-center justify-content-center\' style=\'height: 250px;\'><i class=\'fas fa-apple-alt fa-3x text-white opacity-90\'></i></div>'); this.remove();">
  <div class="product-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
    <div class="overlay-content text-center text-white">
      <div class="btn-group-vertical">
        <a href="{{ url_for('main.product_detail', slug=product.slug) }}" class="btn btn-light btn-sm mb-2">
          <i class="fas fa-eye me-1"></i>{{ _('Quick View') }}
        </a>
        <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-primary btn-sm">
          <i class="fas fa-envelope me-1"></i>{{ _('Get Quote') }}
        </a>
      </div>
    </div>
  </div>
</div>

                    {% else %}
                    <div class="product-image-wrapper position-relative overflow-hidden">
  <div class="card-img-top bg-gradient-primary d-flex align-items-center justify-content-center" style="height: 250px;">
    <i class="fas fa-apple-alt fa-3x text-white opacity-90"></i>
  </div>
  <div class="product-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
    <div class="overlay-content text-center text-white">
      <div class="btn-group-vertical">
        <a href="{{ url_for('main.product_detail', slug=product.slug) }}" class="btn btn-light btn-sm mb-2">
          <i class="fas fa-eye me-1"></i>{{ _('Quick View') }}

                        <!-- Decorative Element -->
                        <div class="product-decoration position-absolute top-0 end-0 p-3">
                            <div class="decoration-circle bg-gradient-primary opacity-25 rounded-circle" style="width: 80px; height: 80px; transform: translate(50%, -50%);"></div>
                        </div>

        </a>
        <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-primary btn-sm">
          <i class="fas fa-envelope me-1"></i>{{ _('Get Quote') }}
        </a>
      </div>
    </div>
  </div>
</div>
                    {% endif %}

                    <!-- Product Info -->
                    <div class="card-body d-flex flex-column">
                        <div class="product-category mb-2">
  <span class="badge bg-light text-primary-custom fw-semibold">{{ product.category.get_name(current_language) if product.category else _('Premium') }}</span>
</div>

                        <h5 class="card-heading {{ 'arabic-heading' if current_language == 'ar' else 'english-heading' }}">{{ product.get_name(current_language) if product.get_name is defined else product.get_name() }}</h5>

                        <p class="card-text {{ 'arabic-text' if current_language == 'ar' else 'english-text' }} text-muted flex-grow-1">
  {{ (product.get_short_description(current_language) if product.get_short_description is defined else product.get_short_description()) | truncate(100) if (product.get_short_description is defined or product.get_short_description()) else _('Premium quality Egyptian agricultural product with exceptional taste and nutritional value.') }}
</p>

                        <!-- Seasonality mini-strip -->
                        {% if seasons_map and seasons_map.get(product.id) %}
                        {% set s = seasons_map.get(product.id) %}
                        <div class="mb-3">
                          <div class="d-flex align-items-center gap-2 small text-muted mb-1">
                            <i class="fas fa-calendar-alt"></i>
                            <span>{% if is_rtl %}التوفر حسب الأشهر{% else %}Monthly availability{% endif %}</span>
                          </div>
                          <div class="d-flex gap-1 flex-wrap">
                            {% set labels_en = {'peak':'Peak','available':'Available','limited':'Limited','off':'Off-season','iqf':'Frozen'} %}
                            {% set labels_ar = {'peak':'ذروة','available':'متاح','limited':'محدود','off':'خارج الموسم','iqf':'مجمّد'} %}
                            {% set months_names_en = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'] %}
                            {% set months_names_ar = ['يناير','فبراير','مارس','أبريل','مايو','يونيو','يوليو','أغسطس','سبتمبر','أكتوبر','نوفمبر','ديسمبر'] %}
                            {% for st in s.months_state %}
                              {% set idx = loop.index0 %}
                              {% set label = (labels_ar if is_rtl else labels_en)[st] %}
                              {% set m_name = months_names_ar[idx] if is_rtl else months_names_en[idx] %}
                              <span class="rounded-pill px-2 py-1 border small state-chip state-{{ st }}" title="{{ product.get_name(current_language) }} — {{ m_name }} • {{ label }}"></span>
                            {% endfor %}
                          </div>
                        </div>
                        {% endif %}

                        <!-- Product Features -->
                        {% set specs = product.get_specifications_lang(current_language) %}
                        {% if specs %}
                        <div class="mb-3">
                            {% if specs.get('sizes') %}
                            <small class="badge bg-light text-dark me-1">{% if is_rtl %}مقاسات متعددة{% else %}{{ _('Multiple Sizes') }}{% endif %}</small>
                            {% endif %}
                            {% if specs.get('brix') %}
                            <small class="badge bg-light text-dark me-1">{{ specs.brix }} {% if is_rtl %}درجة بريكس{% else %}{{ _('Brix') }}{% endif %}</small>
                            {% endif %}
                            {% if product.featured %}
                            <small class="badge bg-warning text-dark">{% if is_rtl %}مميز{% else %}{{ _('Featured') }}{% endif %}</small>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2 mt-auto">
  <a href="{{ url_for('main.product_detail', slug=product.slug) }}" class="btn btn-outline-primary btn-text english-heading flex-grow-1 hover-lift">
    <i class="fas fa-info-circle me-1"></i>{{ _('Details') }}
  </a>
  <a href="{{ url_for('main.contact') }}?product={{ product.slug }}" class="btn btn-primary hover-lift">
    <i class="fas fa-envelope"></i>
  </a>
</div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products and products.pages > 1 %}
        <div class="row mt-5">
            <div class="col-12">
                <nav aria-label="Products pagination">
                    <ul class="pagination justify-content-center">
                        {% if products.has_prev %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('main.products', page=products.prev_num, cat=request.args.get('cat')) }}">
                                <i class="fas fa-chevron-left"></i> {{ 'السابق' if session.get('language') == 'ar' else 'Previous' }}
                            </a>
                        </li>
                        {% endif %}

                        {% for page_num in products.iter_pages() if products %}
                            {% if page_num %}
                                {% if page_num != products.page %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('main.products', page=page_num, cat=request.args.get('cat')) }}">
                                        {{ page_num }}
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item active">
                                    <span class="page-link">{{ page_num }}</span>
                                </li>
                                {% endif %}
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}

<style>
  /* Pagination contrast fixes */
  .pagination .page-item.active .page-link {
    color: #fff !important;
    background-color: #689b8a !important;
    border-color: #689b8a !important;
  }
  .pagination .page-link { color: #4f7f73; }
  .pagination .page-link:hover { color: #3a5f56; }
  html[lang="ar"] .pagination .page-link { font-weight: 600; }

  /* CTA mobile spacing and readability */
  @media (max-width: 767.98px) {
    section[style*="#689b8a"] .section-badge { margin-bottom: .75rem !important; }
    section[style*="#689b8a"] h3 { font-size: 1.25rem; }
    section[style*="#689b8a"] p { font-size: .95rem; }
  }
</style>

                        {% endfor %}

                        {% if products.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="{{ url_for('main.products', page=products.next_num, cat=request.args.get('cat')) }}">
                                {{ 'التالي' if session.get('language') == 'ar' else 'Next' }} <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
        {% endif %}

        {% else %}
        <!-- No Products Found -->
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <div class="py-5">

{% block extra_head %}
<style>
  /* Improve page-level transitions */
  .products-hero .pattern-dots { background-image: radial-gradient(currentColor 1px, transparent 1px); background-size: 10px 10px; color: rgba(0,0,0,.06); }
</style>
{% endblock %}

                    <i class="fas fa-search fa-4x text-muted mb-4"></i>
                    <h3 class="mb-3">{% if is_rtl %}لا توجد منتجات{% else %}{{ _('No Products Found') }}{% endif %}</h3>
                    <p class="text-muted mb-4">
                        {% if selected_category %}
                        {% if is_rtl %}لا توجد منتجات حالياً ضمن فئة {{ selected_category.get_name(current_language) }}.{% else %}{{ _('No products are currently available in the') }} {{ selected_category.get_name(current_language) }} {{ _('category.') }}{% endif %}

<script>
  // START_PRODUCTS_ANIMATIONS (reversible)
  document.addEventListener('DOMContentLoaded', function(){
    // Ripple on category filter buttons
    document.querySelectorAll('.category-filter .btn').forEach(btn => {
      btn.addEventListener('click', function(e){
        const r = document.createElement('span');
        r.className = 'btn-ripple';
        const rect = this.getBoundingClientRect();
        r.style.left = (e.clientX - rect.left) + 'px';
        r.style.top = (e.clientY - rect.top) + 'px';
        this.appendChild(r);
        setTimeout(() => r.remove(), 650);
      });
    });

    // Image skeleton for slow loads
    document.querySelectorAll('.product-image-wrapper img').forEach(img => {
      const wrap = img.closest('.product-image-wrapper');
      if (!wrap) return;
      wrap.classList.add('img-skeleton');
      if (img.complete) wrap.classList.remove('img-skeleton');
      img.addEventListener('load', () => wrap.classList.remove('img-skeleton'));
      img.addEventListener('error', () => wrap.classList.remove('img-skeleton'));
    });

    // Tilt/Parallax on desktop only
    const isMobile = window.matchMedia('(max-width: 991px)').matches;
    if (!isMobile) {
      document.querySelectorAll('.product-card').forEach(card => {
        const img = card.querySelector('.product-image');
        card.addEventListener('mousemove', (e) => {
          const r = card.getBoundingClientRect();
          const x = e.clientX - r.left; const y = e.clientY - r.top;
          const rx = ((y / r.height) - 0.5) * -6;
          const ry = ((x / r.width) - 0.5) * 6;
          card.style.transform = `perspective(800px) rotateX(${rx}deg) rotateY(${ry}deg)`;
        });
        card.addEventListener('mouseleave', () => {
          card.style.transform = '';
        });
      });
    }
  });
  // END_PRODUCTS_ANIMATIONS
</script>

                        {% else %}
                        {% if is_rtl %}لا توجد منتجات مطابقة لمرشحاتك الحالية.{% else %}{{ _('No products match your current filters.') }}{% endif %}
                        {% endif %}
                    </p>
                    <a href="{{ url_for('main.products') }}" class="btn btn-primary">
                        {% if is_rtl %}عرض كل المنتجات{% else %}{{ _('View All Products') }}{% endif %}
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>


<!-- CTA Section copied from homepage Partnership Opportunity -->
<section class="py-5 bg-gradient-primary text-white position-relative overflow-hidden">
    <div class="position-absolute top-0 start-0 w-100 h-100">
        <div class="cta-pattern opacity-10"></div>
    </div>
    <div class="container position-relative">
        <div class="row align-items-center">
            <div class="col-lg-8" data-aos="fade-right">
                <div class="cta-badge badge bg-gradient-secondary text-dark px-4 py-2 rounded-pill mb-3 fs-6 fw-semibold">
                    <i class="fas fa-handshake me-2"></i>{% if is_rtl %}جاهزون للتعاون{% else %}{{ _('Partnership Opportunity') }}{% endif %}
                </div>
                <h2 class="section-heading {{ 'arabic-heading' if is_rtl else 'english-heading' }} text-shadow" style="color: #ffffff;">
                    {% if selected_category %}
                        {% if is_rtl %}هل أنت مهتم بـ <span style="color: var(--secondary-color);">{{ selected_category.get_name(current_language) }}</span>؟{% else %}{{ _('Interested in') }} <span style="color: var(--secondary-color);">{{ selected_category.get_name(current_language) }}</span>?{% endif %}
                    {% else %}
                        {% if is_rtl %}هل انت مستعد للتعاون معنا؟{% else %}{{ _('Ready to Start Your') }} <span style="color: #f9cb99;">{{ _('Premium') }}</span> {{ _('Agricultural Order?') }}{% endif %}
                    {% endif %}
                </h2>
                <p class="lead mb-4 text-shadow-sm">
                    {{ _('Join hundreds of satisfied clients worldwide who trust Emdad Global for their') }}
                    {{ _('agricultural sourcing needs. Get a personalized quote today and experience the difference.') }}
                </p>
                <div class="cta-features row g-3 mb-4">
                    <div class="col-12">
                        <div class="mb-2 d-flex align-items-center justify-content-between small fw-semibold" style="color:#ffffff;">
                            <span>{{ _('Quick Response') }}</span>
                            <span class="progress-value">100%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: rgba(255,255,255,0.15);">
                            <div class="progress-bar" role="progressbar" style="width: 100%; background: #f9cb99;"></div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-2 d-flex align-items-center justify-content-between small fw-semibold" style="color:#ffffff;">
                            <span>{{ _('Quality Guaranteed') }}</span>
                            <span class="progress-value">100%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: rgba(255,255,255,0.15);">
                            <div class="progress-bar" role="progressbar" style="width: 100%; background: #f9cb99;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-lg-center" data-aos="fade-left" data-aos-delay="200">
                <div class="cta-actions">
                    <a href="{{ url_for('main.contact') }}" class="btn btn-secondary btn-lg px-5 py-3 mb-3 d-block hover-lift">
                        <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="line-height:0;">
                            <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M20.5 7.5h-6.25l-1.6-2.4a2 2 0 00-1.66-.9H3.5A2.5 2.5 0 001 6.7v10.8A2.5 2.5 0 003.5 20h17a2.5 2.5 0 002.5-2.5v-7a3 3 0 00-2.5-3zm-8.5 0h-1l-.8-1.2c-.09-.14-.24-.3-.45-.3H3.5a.5.5 0 00-.5.5v.5h9.5zM3 8.5h17.5c.83 0 1.5.67 1.5 1.5v7c0 .55-.45 1-1 1H3.5c-.28 0-.5-.22-.5-.5v-9zM6 13.5h5c.28 0 .5.22.5.5s-.22.5-.5.5H6a.5.5 0 010-1zm0 2h9c.28 0 .5.22.5.5s-.22.5-.5.5H6a.5.5 0 010-1z"/></svg>
                        </span>{% if is_rtl %}اطلب عرض سعر{% else %}{{ _('Request a Quote') }}{% endif %}
                    </a>
                    <a href="{{ url_for('main.products') }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift">
                        <i class="fas fa-leaf me-2"></i>{% if is_rtl %}تصفح المنتجات{% else %}{{ _('Browse Products') }}{% endif %}
                    </a>
                    <div class="contact-info mt-4 p-3 glass-effect rounded-3">
                        <a href="tel:{{ COMPANY_PHONE }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift mb-3" style="border: 2px solid white; color: white; font-weight: 600; backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1);">
                            <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="color: #f9cb99; line-height:0;">
                                <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V21c0 .55-.45 1-1 1C10.07 22 2 13.93 2 3c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.24.2 2.45.57 3.57.11.35.03.74-.24 1.02l-2.2 2.2z"/></svg>
                            </span>
                            <span class="fw-semibold" style="color:#ffffff;">{{ COMPANY_PHONE or '+20-xxx-xxx-xxxx' }}</span>
                        </a>
                        <a href="mailto:{{ COMPANY_EMAIL }}" class="btn btn-outline-light btn-lg px-5 py-3 d-block hover-lift" style="border: 2px solid white; color: white; font-weight: 600; backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1);">
                            <span class="me-2 d-inline-flex align-items-center" aria-hidden="true" style="color: #f9cb99; line-height:0;">
                                <svg viewBox="0 0 24 24" width="18" height="18" role="img" aria-hidden="true" style="display:block;fill:currentColor;"><path d="M2 5h20v14H2V5zm10 7L3.5 7h17L12 12z"/></svg>
                            </span>
                            <span class="fw-semibold" style="color:#ffffff;">{{ COMPANY_EMAIL or 'info@emdadglobal.com' }}</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to product cards
    const productCards = document.querySelectorAll('.product-card');
    productCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-8px)';
            this.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
            this.style.boxShadow = '0 0.75rem 1.5rem rgba(0, 0, 0, 0.15)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });

    // Smooth scroll to products section when coming from category filter
    if (window.location.hash === '#products') {
        document.querySelector('.py-5').scrollIntoView({ behavior: 'smooth' });
    }
});
</script>
{% endblock %}
