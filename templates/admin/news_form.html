{% extends "admin/base.html" %}

{% block title %}
{% if news_item %}{{ _('Edit Article') }}{% else %}{{ _('Add Article') }}{% endif %} - {{ _('Admin Panel') }}
{% endblock %}

{% block extra_css %}
<!-- Date Picker -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<!-- Summernote CSS -->
<link href="{{ url_for('static', filename='css/summernote-lite.min.css') }}" rel="stylesheet">

<style>
.news-form-container {
    background: #f8f9fa;
    min-height: 100vh;
    padding: 2rem 0;
}

.form-card {
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form-header {
    background: #007bff;
    color: white;
    padding: 1.5rem;
    border-radius: 8px 8px 0 0;
}

.form-body {
    padding: 2rem;
}

.form-floating > .form-control {
    border: 1px solid #ced4da;
    border-radius: 6px;
}

.form-floating > .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.nav-tabs .nav-link {
    border: none;
    border-radius: 6px 6px 0 0;
    background: #f8f9fa;
    color: #6c757d;
    margin-right: 5px;
    padding: 12px 20px;
}

.nav-tabs .nav-link.active {
    background: white;
    color: #495057;
    border: 1px solid #dee2e6;
    border-bottom: 1px solid white;
}

.tab-content {
    background: white;
    border: 1px solid #dee2e6;
    border-top: none;
    border-radius: 0 6px 6px 6px;
    padding: 1.5rem;
}

.char-counter {
    font-size: 0.8rem;
    color: #6c757d;
    text-align: right;
    margin-top: 0.25rem;
}

.char-counter.warning {
    color: #fd7e14;
}

.char-counter.danger {
    color: #dc3545;
}

.btn {
    border-radius: 6px;
    font-weight: 500;
}

.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #004085;
}

/* Summernote styling */
.note-editor {
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
}

.note-editor.note-frame {
    border: 1px solid #dee2e6;
}

.note-editor.note-frame.is-invalid {
    border-color: #dc3545;
}

.note-toolbar {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.note-editing-area {
    background-color: #fff;
}

.note-editable {
    padding: 15px;
    min-height: 200px;
    font-size: 14px;
    line-height: 1.6;
}

/* Arabic support */
.note-editable[dir="rtl"] {
    text-align: right;
    font-family: 'Cairo', 'Amiri', 'Noto Sans Arabic', sans-serif;
}

/* Complete fix for Summernote icons - force text display */
.note-toolbar .note-btn {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
    font-size: 12px !important;
    line-height: 1.4 !important;
    padding: 4px 8px !important;
    min-width: auto !important;
}

/* Hide all Font Awesome icons and show text instead */
.note-toolbar .note-btn i {
    display: none !important;
}

.note-toolbar .note-btn:before {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
    font-style: normal !important;
    font-weight: 600 !important;
    font-size: 11px !important;
}

/* Specific button text content */
.note-btn[data-original-title*="Bold"]:before { content: "B"; font-weight: bold; }
.note-btn[data-original-title*="Italic"]:before { content: "I"; font-style: italic; }
.note-btn[data-original-title*="Underline"]:before { content: "U"; text-decoration: underline; }
.note-btn[data-original-title*="Strikethrough"]:before { content: "S"; text-decoration: line-through; }
.note-btn[data-original-title*="Clear"]:before { content: "Clear"; }
.note-btn[data-original-title*="Unordered"]:before { content: "• List"; }
.note-btn[data-original-title*="Ordered"]:before { content: "1. List"; }
.note-btn[data-original-title*="Link"]:before { content: "Link"; }
.note-btn[data-original-title*="Picture"]:before { content: "Image"; }
.note-btn[data-original-title*="Table"]:before { content: "Table"; }
.note-btn[data-original-title*="Horizontal"]:before { content: "Line"; }
.note-btn[data-original-title*="Full"]:before { content: "Full"; }
.note-btn[data-original-title*="Code"]:before { content: "Code"; }
.note-btn[data-original-title*="Color"]:before { content: "Color"; }
.note-btn[data-original-title*="Size"]:before { content: "Size"; }
.note-btn[data-original-title*="Font"]:before { content: "Font"; }
.note-btn[data-original-title*="Style"]:before { content: "Style"; }
.note-btn[data-original-title*="Paragraph"]:before { content: "Para"; }
.note-btn[data-original-title*="Height"]:before { content: "Height"; }
.note-btn[data-original-title*="Help"]:before { content: "Help"; }

/* Dropdown arrows */
.note-toolbar .note-btn .caret {
    display: inline-block !important;
    width: 0 !important;
    height: 0 !important;
    margin-left: 4px !important;
    vertical-align: middle !important;
    border-top: 4px solid #333 !important;
    border-right: 4px solid transparent !important;
    border-left: 4px solid transparent !important;
    border-bottom: 0 !important;
}

/* Color picker styling */
.note-toolbar .note-color .note-recent-color {
    width: 16px !important;
    height: 16px !important;
    border: 1px solid #ddd !important;
    border-radius: 2px !important;
    display: inline-block !important;
    margin-right: 4px !important;
}

/* Dropdown menu styling */
.note-toolbar .dropdown-menu {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
    font-size: 13px !important;
}

/* Button groups spacing */
.note-toolbar .note-btn-group {
    margin-right: 4px !important;
}

/* Active button state */
.note-toolbar .note-btn.active {
    background-color: #007bff !important;
    color: white !important;
}

/* Custom text spans for buttons */
.note-toolbar .btn-text {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
    font-size: 11px !important;
    font-weight: 600 !important;
    line-height: 1 !important;
    display: inline-block !important;
    padding: 0 !important;
    margin: 0 !important;
}

/* Special styling for formatting buttons */
.note-toolbar .btn-text:contains("B") {
    font-weight: bold !important;
}

.note-toolbar .btn-text:contains("I") {
    font-style: italic !important;
}

.note-toolbar .btn-text:contains("U") {
    text-decoration: underline !important;
}

.note-toolbar .btn-text:contains("S") {
    text-decoration: line-through !important;
}

@media (max-width: 768px) {
    .news-form-container {
        padding: 1rem 0;
    }
    
    .form-body {
        padding: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="news-form-container">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                
                <!-- Page Header -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="mb-1">
                            <i class="fas fa-newspaper text-primary me-2"></i>
                            {% if news_item %}{{ _('Edit Article') }}{% else %}{{ _('Add New Article') }}{% endif %}
                        </h2>
                        <p class="text-muted mb-0">{{ _('Create and manage news articles') }}</p>
                    </div>
                    <a href="{{ url_for('admin.news') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>{{ _('Back to News') }}
                    </a>
                </div>

                <!-- Main Form -->
                <div class="card form-card">
                    <div class="card-header form-header">
                        <h5 class="mb-0">
                            <i class="fas fa-edit me-2"></i>{{ _('Article Details') }}
                        </h5>
                    </div>

                    <div class="card-body form-body">
                        <form method="POST" enctype="multipart/form-data" id="newsForm">
                            {{ form.hidden_tag() }}
                            
                            <!-- Basic Information -->
                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <div class="form-floating mb-3">
                                        {{ form.title_en(class="form-control", placeholder=_("Enter article title")) }}
                                        <label for="title_en" class="form-label">{{ _('Title') }} ({{ _('English') }})</label>
                                        {% if form.title_en.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.title_en.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                        <div class="char-counter" id="title-counter">0/200</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        {{ form.slug(class="form-control", placeholder=_("article-url-slug")) }}
                                        <label for="slug" class="form-label">{{ _('URL Slug') }}</label>
                                        {% if form.slug.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.slug.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Excerpt -->
                            <div class="form-floating mb-4">
                                {{ form.excerpt_en(class="form-control", placeholder=_("Brief description"), rows="3") }}
                                <label for="excerpt_en" class="form-label">{{ _('Excerpt') }} ({{ _('English') }})</label>
                                {% if form.excerpt_en.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.excerpt_en.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <div class="char-counter" id="excerpt-counter">0/500</div>
                            </div>

                            <!-- Content Tabs -->
                            <div class="mb-4">
                                <ul class="nav nav-tabs" id="contentTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="english-tab" data-bs-toggle="tab"
                                                data-bs-target="#english" type="button" role="tab">
                                            <i class="fas fa-globe me-1"></i>{{ _('English Content') }}
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="arabic-tab" data-bs-toggle="tab"
                                                data-bs-target="#arabic" type="button" role="tab">
                                            <i class="fas fa-globe me-1"></i>{{ _('Arabic Content') }}
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content" id="contentTabsContent">
                                    <!-- English Content -->
                                    <div class="tab-pane fade show active" id="english" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="title_ar" class="form-label">{{ _('Title') }} ({{ _('Arabic') }})</label>
                                            {{ form.title_ar(class="form-control", placeholder=_("Enter article title"), dir="rtl") }}
                                            {% if form.title_ar.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.title_ar.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>

                                        <div class="mb-3">
                                            <label for="excerpt_ar" class="form-label">{{ _('Excerpt') }} ({{ _('Arabic') }})</label>
                                            {{ form.excerpt_ar(class="form-control", placeholder=_("Brief description"), rows="3", dir="rtl") }}
                                            {% if form.excerpt_ar.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.excerpt_ar.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>

                                        <div class="mb-3">
                                            <label for="content_en" class="form-label">{{ _('Content') }} ({{ _('English') }})</label>
                                            {{ form.content_en(class="form-control summernote", id="content_en") }}
                                            {% if form.content_en.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.content_en.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- Arabic Content -->
                                    <div class="tab-pane fade" id="arabic" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="content_ar" class="form-label">{{ _('Content') }} ({{ _('Arabic') }})</label>
                                            {{ form.content_ar(class="form-control summernote", id="content_ar", dir="rtl") }}
                                            {% if form.content_ar.errors %}
                                                <div class="invalid-feedback d-block">
                                                    {% for error in form.content_ar.errors %}{{ error }}{% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Publishing Options -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        {{ form.status(class="form-select") }}
                                        <label for="status" class="form-label">{{ _('Status') }}</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating mb-3">
                                        {{ form.publish_at(class="form-control datetime-picker", placeholder=_("Select date")) }}
                                        <label for="publish_at" class="form-label">{{ _('Publish Date') }}</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating mb-3">
                                        {{ form.tags(class="form-control", placeholder=_("tag1, tag2, tag3")) }}
                                        <label for="tags" class="form-label">{{ _('Tags') }}</label>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-check mt-4">
                                        {{ form.featured(class="form-check-input") }}
                                        <label for="featured" class="form-check-label">{{ _('Featured') }}</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Cover Image -->
                            <div class="mb-4">
                                <label for="cover_image" class="form-label">{{ _('Cover Image') }}</label>
                                {{ form.cover_image(class="form-control") }}
                                {% if form.cover_image.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.cover_image.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                {% if news_item and news_item.cover_image %}
                                    <div class="mt-2">
                                        <small class="text-muted">{{ _('Current Image') }}:</small><br>
                                        <img src="{{ url_for('main.uploaded_file', filename='news/' + news_item.cover_image) }}"
                                             alt="{{ news_item.title_en }}" class="img-thumbnail" style="max-width: 200px;">
                                    </div>
                                {% endif %}
                                <div class="form-text">{{ _('Upload cover image (JPG, PNG, WebP - Max 5MB)') }}</div>
                            </div>

                            <!-- Form Actions -->
                            <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                                <div>
                                    <span class="badge bg-secondary me-2">{{ _('Draft') }}</span>
                                    <small class="text-muted">{{ _('Auto-save: Enabled') }}</small>
                                </div>
                                <div class="d-flex gap-2">
                                    <button type="submit" name="action" value="draft" class="btn btn-outline-primary">
                                        <i class="fas fa-save me-1"></i>{{ _('Save Draft') }}
                                    </button>
                                    <button type="submit" name="action" value="publish" class="btn btn-primary">
                                        <i class="fas fa-paper-plane me-1"></i>{{ _('Publish') }}
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Date Picker -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Summernote JavaScript -->
<script src="{{ url_for('static', filename='js/summernote-lite.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/summernote-ar-AR.min.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Summernote editors
    $('.summernote').summernote({
        height: 300,
        minHeight: 200,
        maxHeight: 500,
        focus: false,
        lang: '{{ current_language }}' === 'ar' ? 'ar-AR' : 'en-US',
        direction: '{{ current_language }}' === 'ar' ? 'rtl' : 'ltr',
        toolbar: [
            ['style', ['style']],
            ['font', ['bold', 'italic', 'underline', 'clear']],
            ['fontname', ['fontname']],
            ['fontsize', ['fontsize']],
            ['color', ['color']],
            ['para', ['ul', 'ol', 'paragraph']],
            ['table', ['table']],
            ['insert', ['link', 'picture', 'hr']],
            ['view', ['fullscreen', 'codeview']]
        ],
        icons: {
            // Text formatting
            'bold': '<b>B</b>',
            'italic': '<i>I</i>',
            'underline': '<u>U</u>',
            'strikethrough': '<s>S</s>',
            'superscript': 'x²',
            'subscript': 'x₂',
            'clear': 'Clear',

            // Lists
            'insertOrderedList': '1.',
            'insertUnorderedList': '•',
            'orderedlist': '1.',
            'unorderedlist': '•',

            // Alignment
            'justifyLeft': 'Left',
            'justifyCenter': 'Center',
            'justifyRight': 'Right',
            'justifyFull': 'Justify',
            'align': 'Align',
            'alignCenter': 'Center',
            'alignJustify': 'Justify',
            'alignLeft': 'Left',
            'alignRight': 'Right',

            // Indentation
            'indent': 'Indent',
            'outdent': 'Outdent',

            // Insert elements
            'link': 'Link',
            'unlink': 'Unlink',
            'picture': 'Image',
            'table': 'Table',
            'hr': 'Line',
            'insertHorizontalRule': 'Line',

            // Table operations
            'rowBelow': '+Row',
            'colBefore': '+Col',
            'colAfter': '+Col',
            'rowAbove': '+Row',
            'rowRemove': '-Row',
            'colRemove': '-Col',

            // View options
            'fullscreen': 'Full',
            'codeview': 'Code',
            'code': 'Code',

            // History
            'undo': 'Undo',
            'redo': 'Redo',

            // Font options
            'font': 'Font',
            'fontname': 'Font',
            'fontsize': 'Size',
            'fontsizeunit': 'px',
            'color': 'Color',
            'forecolor': 'Text',
            'backcolor': 'Back',

            // Misc
            'style': 'Style',
            'paragraph': 'Para',
            'height': 'Height',
            'help': 'Help',
            'close': '×',
            'caret': '▼',
            'caretup': '▲',
            'dropdown-toggle': '▼',
            'menuCheck': '✓',
            'circle': '○',
            'square': '□',
            'pencil': 'Edit',
            'eraser': 'Clear',
            'magic': 'Format',
            'trash': 'Delete',
            'question': '?',
            'exclamation': '!',
            'frame': 'Frame',
            'resize': 'Resize',
            'arrowsAlt': 'Move',
            'textHeight': 'Height'
        },
        fontNames: [
            'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',
            'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',
            'Tahoma', 'Times New Roman', 'Verdana',
            'Cairo', 'Amiri', 'Noto Sans Arabic', 'Tajawal'
        ],
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '28', '32', '36', '48', '64'],
        placeholder: '{{ current_language }}' === 'ar' ? 'اكتب المحتوى هنا...' : 'Write your content here...',
        callbacks: {
            onImageUpload: function(files) {
                for (let i = 0; i < files.length; i++) {
                    uploadImage(files[i], this);
                }
            },
            onInit: function() {
                // Fix any remaining icon issues after initialization
                fixSummernoteIcons();
            }
        }
    });

    // Excerpt fields are now simple textareas (no rich editor needed)

    // Function to completely fix Summernote icons
    function fixSummernoteIcons() {
        setTimeout(function() {
            // Remove all Font Awesome icons and replace with text
            $('.note-toolbar .note-btn').each(function() {
                var $btn = $(this);
                var $icon = $btn.find('i');
                var title = $btn.attr('data-original-title') || $btn.attr('title') || '';

                // Remove the icon element completely
                $icon.remove();

                // Add text content based on button function
                var textContent = '';
                if (title.includes('Bold')) textContent = 'B';
                else if (title.includes('Italic')) textContent = 'I';
                else if (title.includes('Underline')) textContent = 'U';
                else if (title.includes('Strikethrough')) textContent = 'S';
                else if (title.includes('Clear') || title.includes('Remove')) textContent = 'Clear';
                else if (title.includes('Unordered')) textContent = '• List';
                else if (title.includes('Ordered')) textContent = '1. List';
                else if (title.includes('Link')) textContent = 'Link';
                else if (title.includes('Picture') || title.includes('Image')) textContent = 'Image';
                else if (title.includes('Table')) textContent = 'Table';
                else if (title.includes('Horizontal') || title.includes('Rule')) textContent = 'Line';
                else if (title.includes('Full')) textContent = 'Full';
                else if (title.includes('Code')) textContent = 'Code';
                else if (title.includes('Color')) textContent = 'Color';
                else if (title.includes('Size')) textContent = 'Size';
                else if (title.includes('Font')) textContent = 'Font';
                else if (title.includes('Style')) textContent = 'Style';
                else if (title.includes('Paragraph')) textContent = 'Para';
                else if (title.includes('Height')) textContent = 'Height';
                else if (title.includes('Help')) textContent = 'Help';
                else if (title.includes('Indent')) textContent = 'Indent';
                else if (title.includes('Outdent')) textContent = 'Outdent';
                else if (title.includes('Left')) textContent = 'Left';
                else if (title.includes('Center')) textContent = 'Center';
                else if (title.includes('Right')) textContent = 'Right';
                else if (title.includes('Justify')) textContent = 'Justify';

                // If we found appropriate text, add it to the button
                if (textContent && !$btn.find('.btn-text').length) {
                    $btn.prepend('<span class="btn-text">' + textContent + '</span>');
                }
            });

            // Fix dropdown carets specifically
            $('.note-toolbar .caret').each(function() {
                var $caret = $(this);
                $caret.empty().css({
                    'display': 'inline-block',
                    'width': '0',
                    'height': '0',
                    'margin-left': '4px',
                    'vertical-align': 'middle',
                    'border-top': '4px solid #333',
                    'border-right': '4px solid transparent',
                    'border-left': '4px solid transparent',
                    'border-bottom': '0'
                });
            });

            // Force refresh of toolbar
            $('.note-toolbar').css('visibility', 'hidden').css('visibility', 'visible');

        }, 200);
    }

    // Image upload function
    function uploadImage(file, editor) {
        var data = new FormData();
        data.append("file", file);
        data.append("csrf_token", "{{ csrf_token() }}");

        $.ajax({
            url: "/admin/upload-editor-image",
            cache: false,
            contentType: false,
            processData: false,
            data: data,
            type: "POST",
            success: function(response) {
                if (response.success) {
                    $(editor).summernote('insertImage', response.url);
                } else {
                    alert('{{ _("Image upload failed") }}: ' + response.error);
                }
            },
            error: function() {
                alert('{{ _("Image upload failed") }}');
            }
        });
    }

    // Initialize date/time picker
    const publishField = document.querySelector('.datetime-picker');
    if (publishField) {
        flatpickr(publishField, {
            enableTime: true,
            dateFormat: "Y-m-d H:i:S",
            time_24hr: true,
            defaultDate: "{{ news_item.publish_at.strftime('%Y-%m-%d %H:%M:%S') if news_item and news_item.publish_at else '' }}",
            locale: {
                firstDayOfWeek: 1
            },
            allowInput: true
        });
    }

    // Character counters
    function updateCharCounter(input, counterId, maxLength) {
        const counter = document.getElementById(counterId);
        if (!counter) return;

        const length = input.value.length;
        counter.textContent = `${length}/${maxLength}`;

        counter.className = 'char-counter';
        if (length > maxLength * 0.9) {
            counter.classList.add('danger');
        } else if (length > maxLength * 0.7) {
            counter.classList.add('warning');
        }
    }

    // Setup character counters
    const titleInput = document.getElementById('title_en');
    const excerptInput = document.getElementById('excerpt_en');

    if (titleInput) {
        titleInput.addEventListener('input', () => updateCharCounter(titleInput, 'title-counter', 200));
        updateCharCounter(titleInput, 'title-counter', 200); // Initial count
    }

    if (excerptInput) {
        excerptInput.addEventListener('input', () => updateCharCounter(excerptInput, 'excerpt-counter', 500));
        updateCharCounter(excerptInput, 'excerpt-counter', 500); // Initial count
    }

    // Auto-generate slug from title
    if (titleInput) {
        titleInput.addEventListener('input', function() {
            const slug = this.value
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
            const slugField = document.getElementById('slug');
            if (slugField && !slugField.value) {
                slugField.value = slug;
            }
        });
    }

    // Form validation
    const form = document.getElementById('newsForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            const titleEn = document.getElementById('title_en').value.trim();
            const contentEn = $('#content_en').summernote('code');

            if (!titleEn) {
                e.preventDefault();
                alert('{{ _("Please enter an English title") }}');
                return false;
            }

            if (!contentEn || contentEn.length < 50) {
                e.preventDefault();
                alert('{{ _("Please enter article content (minimum 50 characters)") }}');
                return false;
            }
        });
    }
});
</script>
{% endblock %}
